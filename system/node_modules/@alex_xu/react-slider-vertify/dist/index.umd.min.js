!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).reactSliderVertify={},e.React)}(this,(function(e,t){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=r(t);function o(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function u(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}},r.exports),r.exports}var i=u((function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.default=e.exports,e.exports.__esModule=!0})),a=u((function(e){e.exports=function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,u=[],i=!0,a=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(u.push(n.value),!t||u.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(a)throw o}}return u}},e.exports.default=e.exports,e.exports.__esModule=!0})),c=u((function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);t>r;r++)n[r]=e[r];return n},e.exports.default=e.exports,e.exports.__esModule=!0})),l=u((function(e){e.exports=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}},e.exports.default=e.exports,e.exports.__esModule=!0})),s=u((function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0})),f=o(u((function(e){e.exports=function(e,t){return i(e)||a(e,t)||l(e,t)||s()},e.exports.default=e.exports,e.exports.__esModule=!0})));function d(e,t){return Math.round(Math.random()*(t-e)+e)}function p(e,t){return e+t}function h(e){return e*e}e.Vertify=t.memo((function(e){var r=e.width,o=void 0===r?320:r,u=e.height,i=void 0===u?160:u,a=e.l,c=void 0===a?42:a,l=e.r,s=void 0===l?9:l,m=e.imgUrl,v=e.text,y=e.refreshIcon,x=void 0===y?"http://cdn.dooring.cn/dr/icon12.png":y,g=e.visible,b=void 0===g||g,w=e.onDraw,M=e.onCustomVertify,C=e.onBeforeRefresh,_=e.onSuccess,E=e.onFail,S=e.onRefresh,T=t.useState(!1),R=f(T,2),I=R[0],N=R[1],A=t.useState(0),j=f(A,2),D=j[0],O=j[1],X=t.useState("sliderContainer"),k=f(X,2),q=k[0],P=k[1],U=t.useState(v),Y=f(U,2),V=Y[0],F=Y[1],L=t.useRef(null),W=t.useRef(null),B=t.useRef(null),G=t.useRef(!1),H=t.useRef([]),$=t.useRef(0),z=t.useRef(0),J=t.useRef(0),K=t.useRef(0),Q=Math.PI,Z=c+2*s+3,ee=function(e,t,r,n){e.beginPath(),e.moveTo(t,r),e.arc(t+c/2,r-s+2,s,.72*Q,2.26*Q),e.lineTo(t+c,r),e.arc(t+c+s-2,r+c/2,s,1.21*Q,2.78*Q),e.lineTo(t+c,r+c),e.lineTo(t,r+c),e.arc(t+s-2,r+c/2,s+.4,2.76*Q,1.24*Q,!0),e.lineTo(t,r),e.lineWidth=2,e.fillStyle="rgba(255, 255, 255, 0.7)",e.strokeStyle="rgba(255, 255, 255, 0.7)",e.stroke(),e.globalCompositeOperation="destination-over","fill"===n?e.fill():e.clip()},te=function(){return m||"https://picsum.photos/id/".concat(d(0,1084),"/").concat(o,"/").concat(i)},re=function(){var e=function(e){var t=new Image;return t.crossOrigin="Anonymous",t.onload=e,t.onerror=function(){t.setSrc(te())},t.setSrc=function(e){if(window.navigator.userAgent.indexOf("Trident")>-1){var r=new XMLHttpRequest;r.onloadend=function(e){var r=new FileReader;r.readAsDataURL(e.target.response),r.onloadend=function(e){var r;t.src=null==e||null===(r=e.target)||void 0===r?void 0:r.result}},r.open("GET",e),r.responseType="blob",r.send()}else t.src=e},t.setSrc(te()),t}((function(){N(!1),function(e){var t=L.current.getContext("2d"),r=W.current.getContext("2d");J.current=d(Z+10,o-(Z+10)),K.current=d(10+2*s,i-(Z+10)),ee(t,J.current,K.current,"fill"),ee(r,J.current,K.current,"clip"),t.drawImage(e,0,0,o,i),r.drawImage(e,0,0,o,i);var n=K.current-2*s-1,u=r.getImageData(J.current-3,n,Z,Z);W.current.width=Z,r.putImageData(u,0,n)}(e)}));B.current=e},ne=function(){var e=L.current.getContext("2d"),t=W.current.getContext("2d");O(0),P("sliderContainer"),W.current.width=o,W.current.style.left="0px",e.clearRect(0,0,o,i),t.clearRect(0,0,o,i),C&&C(),N(!0),B.current.setSrc(te())},oe=function(){var e=H.current,t=e.reduce(p)/e.length,r=e.map((function(e){return e-t})),n=Math.sqrt(r.map(h).reduce(p)/e.length),o=parseInt(W.current.style.left);return{spliced:10>Math.abs(o-J.current),verified:0!==n,left:o,destX:J.current}},ue=function(e){$.current=e.clientX||e.touches[0].clientX,z.current=e.clientY||e.touches[0].clientY,G.current=!0},ie=function(e){if(!G.current)return!1;e.preventDefault();var t=(e.clientX||e.touches[0].clientX)-$.current,r=(e.clientY||e.touches[0].clientY)-z.current;if(0>t||t+38>=o)return!1;O(t);var n=(o-40-20)/(o-40)*t;W.current.style.left=n+"px",P("sliderContainer sliderContainer_active"),H.current.push(r),w&&w(n)},ae=function(e){if(!G.current)return!1;if(G.current=!1,(e.clientX||e.changedTouches[0].clientX)===$.current)return!1;P("sliderContainer");var t=M?M(oe()):oe();t.spliced?t.verified?(P("sliderContainer sliderContainer_success"),"function"==typeof _&&_()):(P("sliderContainer sliderContainer_fail"),F("请再试一次"),ne()):(P("sliderContainer sliderContainer_fail"),"function"==typeof E&&E(),setTimeout(ne.bind(undefined),1e3))};return t.useEffect((function(){b&&(B.current?ne():re())}),[b]),n.default.createElement("div",{className:"vertifyWrap",style:{width:o+"px",margin:"0 auto",display:b?"":"none"},onMouseMove:ie,onMouseUp:ae,onTouchMove:ie,onTouchEnd:ae},n.default.createElement("div",{className:"canvasArea"},n.default.createElement("canvas",{ref:L,width:o,height:i}),n.default.createElement("canvas",{ref:W,className:"block",width:o,height:i,onMouseDown:ue,onTouchStart:ue})),n.default.createElement("div",{className:q,style:{pointerEvents:I?"none":"auto",width:o+"px"}},n.default.createElement("div",{className:"sliderMask",style:{width:D+"px"}},n.default.createElement("div",{className:"slider",style:{left:D+"px"},onMouseDown:ue,onTouchStart:ue},n.default.createElement("div",{className:"sliderIcon"},"→"))),n.default.createElement("div",{className:"sliderText"},V)),n.default.createElement("div",{className:"refreshIcon",onClick:function(){ne(),"function"==typeof S&&S()},style:{backgroundImage:"url(".concat(x,")")}}),n.default.createElement("div",{className:"loadingContainer",style:{width:o+"px",height:i+"px",display:I?"":"none"}},n.default.createElement("div",{className:"loadingIcon"}),n.default.createElement("span",null,"加载中...")))})),Object.defineProperty(e,"__esModule",{value:!0})}));
