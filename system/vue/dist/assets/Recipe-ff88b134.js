import{_ as X,r as Y,A as Z,o as _,c as y,d as s,e,w as o,i as E,z as ee,J as le,C as te,D as oe,F as ae,q as r,t as c,h as se,u as ne,K as ie,L as z,M as D,G as de,E as b,x as re,N as pe,O as ue,P as ce,I as me,H as fe,k as _e,v as ge,y as ye,n as be,Q as Ve,R as he,p as xe,j as ve}from"./index-c7857d1d.js";/* empty css               *//* empty css                   *//* empty css                    *//* empty css              *//* empty css                 *//* empty css             *//* empty css               *//* empty css                *//* empty css                     *//* empty css            */import{r as U}from"./request-2e544c9a.js";const V=w=>(xe("data-v-ac72c4f7"),w=w(),ve(),w),we={class:"card",style:{"margin-bottom":"5px"}},ke={class:"card",style:{"margin-bottom":"5px"}},Ee={key:0,style:{"margin-bottom":"10px"}},Ue={class:"card"},Re={style:{display:"flex","align-items":"center",gap:"20px"}},Ie={key:0,style:{"flex-shrink":"0",position:"relative"}},Ce={style:{flex:"1"}},Ne=V(()=>s("div",{style:{"margin-top":"10px",color:"#999","font-size":"12px"}}," 支持 JPG、PNG 格式，文件大小不超过 2MB ",-1)),Se={class:"dialog-footer"},ze={key:0,style:{padding:"20px"}},De={style:{"margin-top":"0"}},Pe={style:{color:"#666","line-height":"1.6"}},Te={style:{"text-align":"center"}},Oe={style:{"font-size":"24px",color:"#409EFF","font-weight":"bold"}},Ae=V(()=>s("div",{style:{color:"#999"}},"分钟",-1)),Fe={style:{"text-align":"center"}},Je={style:{"font-size":"24px",color:"#67C23A","font-weight":"bold"}},Be=V(()=>s("div",{style:{color:"#999"}},"卡路里",-1)),Le={style:{"text-align":"center"}},Me={style:{"font-size":"24px",color:"#E6A23C","font-weight":"bold"}},$e=V(()=>s("div",{style:{color:"#999"}},"蛋白质(g)",-1)),je={style:{"text-align":"center"}},qe={style:{"font-size":"24px",color:"#F56C6C","font-weight":"bold"}},Ge=V(()=>s("div",{style:{color:"#999"}},"难度",-1)),He=V(()=>s("h3",null,"食材清单",-1)),Ke={style:{background:"#f8f9fa",padding:"15px","border-radius":"6px"}},Qe={style:{"margin-left":"10px"}},We=V(()=>s("h3",null,"烹饪步骤",-1)),Xe={style:{background:"#f8f9fa",padding:"15px","border-radius":"6px"}},Ye={style:{display:"flex","align-items":"flex-start"}},Ze={style:{background:"#409EFF",color:"white",width:"24px",height:"24px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","margin-right":"10px","flex-shrink":"0"}},el={style:{"line-height":"1.6"}},ll={class:"dialog-footer"},v="/images/default-image.png",tl={__name:"Recipe",setup(w){const R=n=>{if(!n)return"";let t=n;const i=n.indexOf("?");return i>0&&(t=n.substring(0,i)),t},P="http://:9090/files/upload",l=Y({pageNum:1,pageSize:10,total:0,formVisible:!1,detailVisible:!1,currentRecipe:null,form:{},tableData:[],name:null,category:null,difficulty:null,userRole:JSON.parse(localStorage.getItem("system-user")||"{}").role||"USER"}),I=(n,t=null)=>{console.error("图片加载失败:",n);const i=n.target;t&&t.image&&console.warn(`食谱ID: ${t.id}, 图片URL: ${t.image} 加载失败`),i.src!==v&&(console.log("使用默认图片"),i.src=v)};Z(()=>{console.log("组件挂载完成，自动调用load函数"),h()});const T=()=>{l.form={},l.formVisible=!0},O=n=>{l.currentRecipe=JSON.parse(JSON.stringify(n)),l.detailVisible=!0},A=(n,t)=>{t&&t.stopPropagation(),l.form=JSON.parse(JSON.stringify(n)),l.formVisible=!0},F=()=>{U.post("/recipe/add",l.form).then(n=>{n.code==="200"?(l.formVisible=!1,setTimeout(()=>{l.pageNum=1,h()},100),b.success("操作成功")):b.error(n.msg)})},J=()=>{U.put("/recipe/update",l.form).then(n=>{n.code==="200"?(l.formVisible=!1,setTimeout(()=>{h()},100),b.success("操作成功")):b.error(n.msg)})},B=()=>{l.form.id?J():F()},L=(n,t)=>{t&&t.stopPropagation(),de.confirm("删除后数据无法恢复，您确定删除吗?","删除确认",{type:"warning"}).then(i=>{U.delete("/recipe/delete/"+n).then(d=>{d.code==="200"?(setTimeout(()=>{l.tableData.length===1&&l.pageNum>1&&l.pageNum--,h()},100),b.success("操作成功")):b.error(d.msg)})}).catch(i=>{})},M=()=>{l.form.image=null},$=()=>{l.name=null,l.category=null,l.difficulty=null,h()},j=n=>{console.log("上传响应:",n);const t=n.data;console.log("使用完整OSS URL:",t),l.form.image=t;const i=new Image;i.onload=()=>console.log("图片URL有效，能够正常加载"),i.onerror=()=>console.error("图片URL无效，无法加载图片"),i.src=t,b.success("上传成功")},h=()=>{console.log("开始加载食谱数据");const n={pageNum:l.pageNum,pageSize:l.pageSize,name:l.name,category:l.category,difficulty:l.difficulty};console.log("发送API请求获取食谱数据，参数:",n),U.get("/recipe/selectPage",{params:n}).then(t=>{console.log("API响应完整内容:",JSON.stringify(t,null,2)),t.code==="200"&&t.data?(console.log("响应数据类型:",typeof t.data),console.log("响应数据属性:",Object.keys(t.data)),l.tableData=t.data.list||[],l.total=t.data.total||0,console.log("表格数据已设置，数量:",l.tableData.length),l.tableData.length>0?(console.log("获取到的前5条食谱数据示例:"),l.tableData.slice(0,5).forEach(i=>{console.log(`食谱ID: ${i.id}, 名称: ${i.name}, 图片URL: ${i.image}`)})):console.log("未获取到任何食谱数据")):(console.error("获取数据失败，响应码:",t.code,"响应消息:",t.msg||t.message),l.tableData=[],l.total=0)}).catch(t=>{console.error("API请求失败，错误详情:",t),t.response&&(console.error("服务器响应状态:",t.response.status),console.error("服务器响应数据:",t.response.data)),l.tableData=[],l.total=0})};return(n,t)=>{const i=re,d=pe,p=ue,k=ce,f=ee,x=le,C=me,g=fe,q=te,G=oe,H=_e,K=ge,u=ye,Q=be,S=ae,N=Ve,W=he;return _(),y("div",null,[s("div",we,[e(x,{gutter:20},{default:o(()=>[e(d,{span:8},{default:o(()=>[e(i,{modelValue:l.name,"onUpdate:modelValue":t[0]||(t[0]=a=>l.name=a),style:{width:"100%"},placeholder:"请输入食谱名称查询"},null,8,["modelValue"])]),_:1}),e(d,{span:4},{default:o(()=>[e(k,{modelValue:l.category,"onUpdate:modelValue":t[1]||(t[1]=a=>l.category=a),style:{width:"100%"},placeholder:"分类",clearable:""},{default:o(()=>[e(p,{label:"家常菜",value:"家常菜"}),e(p,{label:"健康餐",value:"健康餐"}),e(p,{label:"减脂餐",value:"减脂餐"}),e(p,{label:"素菜",value:"素菜"}),e(p,{label:"荤菜",value:"荤菜"})]),_:1},8,["modelValue"])]),_:1}),e(d,{span:4},{default:o(()=>[e(k,{modelValue:l.difficulty,"onUpdate:modelValue":t[2]||(t[2]=a=>l.difficulty=a),style:{width:"100%"},placeholder:"难度",clearable:""},{default:o(()=>[e(p,{label:"简单",value:"简单"}),e(p,{label:"中等",value:"中等"}),e(p,{label:"困难",value:"困难"})]),_:1},8,["modelValue"])]),_:1}),e(d,{span:4},{default:o(()=>[e(f,{type:"primary",onClick:h},{default:o(()=>[r("查询")]),_:1}),e(f,{type:"info",style:{"margin-left":"10px"},onClick:$},{default:o(()=>[r("重置")]),_:1})]),_:1})]),_:1})]),s("div",ke,[l.userRole==="ADMIN"?(_(),y("div",Ee,[e(f,{type:"primary",onClick:T},{default:o(()=>[r("新增食谱")]),_:1})])):E("",!0),e(q,{data:l.tableData,stripe:"",onRowClick:O},{default:o(()=>[e(g,{label:"食谱图片",width:"100"},{default:o(a=>[e(C,{src:R(a.row.image),style:{width:"60px",height:"60px","border-radius":"6px"},fallback:v,onError:m=>I(m,a.row)},null,8,["src","onError"])]),_:1}),e(g,{label:"食谱名称",prop:"name",width:"200"}),e(g,{label:"描述",prop:"description","show-overflow-tooltip":""}),e(g,{label:"分类",prop:"category",width:"100"}),e(g,{label:"难度",prop:"difficulty",width:"80"}),e(g,{label:"烹饪时间",width:"100"},{default:o(a=>[r(c(a.row.cookingTime)+"分钟 ",1)]),_:1}),e(g,{label:"热量",width:"80"},{default:o(a=>[r(c(a.row.calories)+"卡 ",1)]),_:1}),l.userRole==="ADMIN"?(_(),se(g,{key:0,label:"操作",align:"center",width:"150"},{default:o(a=>[e(f,{type:"warning",size:"small",onClick:m=>A(a.row,m)},{default:o(()=>[r("编辑")]),_:2},1032,["onClick"]),e(f,{type:"danger",size:"small",onClick:m=>L(a.row.id,m)},{default:o(()=>[r("删除")]),_:2},1032,["onClick"])]),_:1})):E("",!0)]),_:1},8,["data"])]),s("div",Ue,[e(G,{background:"",layout:"prev, pager, next","page-size":l.pageSize,"onUpdate:pageSize":t[3]||(t[3]=a=>l.pageSize=a),"current-page":l.pageNum,"onUpdate:currentPage":t[4]||(t[4]=a=>l.pageNum=a),total:l.total},null,8,["page-size","current-page","total"])]),e(S,{title:l.form.id?"编辑食谱":"新增食谱",width:"50%",modelValue:l.formVisible,"onUpdate:modelValue":t[18]||(t[18]=a=>l.formVisible=a),"close-on-click-modal":!1,"destroy-on-close":""},{footer:o(()=>[s("span",Se,[e(f,{onClick:t[17]||(t[17]=a=>l.formVisible=!1)},{default:o(()=>[r("取 消")]),_:1}),e(f,{type:"primary",onClick:B},{default:o(()=>[r("保 存")]),_:1})])]),default:o(()=>[e(Q,{model:l.form,"label-width":"100px",style:{"padding-right":"50px"}},{default:o(()=>[e(u,{label:"食谱图片",prop:"image"},{default:o(()=>[s("div",Re,[l.form.image?(_(),y("div",Ie,[e(C,{src:R(l.form.image),style:{width:"120px",height:"120px","border-radius":"8px",border:"1px solid #eee"},fallback:v,onError:t[5]||(t[5]=a=>I(a))},null,8,["src"]),e(f,{type:"danger",size:"small",circle:"",style:{position:"absolute",top:"-8px",right:"-8px",padding:"4px"},onClick:M},{default:o(()=>[e(H,null,{default:o(()=>[e(ne(ie))]),_:1})]),_:1})])):E("",!0),s("div",Ce,[e(K,{action:P,"list-type":"picture","on-success":j,"show-file-list":!1},{default:o(()=>[e(f,{type:"primary"},{default:o(()=>[r("上传图片")]),_:1})]),_:1}),Ne])])]),_:1}),e(u,{label:"食谱名称",prop:"name"},{default:o(()=>[e(i,{modelValue:l.form.name,"onUpdate:modelValue":t[6]||(t[6]=a=>l.form.name=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(u,{label:"描述",prop:"description"},{default:o(()=>[e(i,{type:"textarea",modelValue:l.form.description,"onUpdate:modelValue":t[7]||(t[7]=a=>l.form.description=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(x,null,{default:o(()=>[e(d,{span:12},{default:o(()=>[e(u,{label:"分类",prop:"category"},{default:o(()=>[e(k,{modelValue:l.form.category,"onUpdate:modelValue":t[8]||(t[8]=a=>l.form.category=a),style:{width:"100%"}},{default:o(()=>[e(p,{label:"家常菜",value:"家常菜"}),e(p,{label:"健康餐",value:"健康餐"}),e(p,{label:"减脂餐",value:"减脂餐"}),e(p,{label:"素菜",value:"素菜"}),e(p,{label:"荤菜",value:"荤菜"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:o(()=>[e(u,{label:"难度",prop:"difficulty"},{default:o(()=>[e(k,{modelValue:l.form.difficulty,"onUpdate:modelValue":t[9]||(t[9]=a=>l.form.difficulty=a),style:{width:"100%"}},{default:o(()=>[e(p,{label:"简单",value:"简单"}),e(p,{label:"中等",value:"中等"}),e(p,{label:"困难",value:"困难"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(x,null,{default:o(()=>[e(d,{span:12},{default:o(()=>[e(u,{label:"烹饪时间",prop:"cookingTime"},{default:o(()=>[e(i,{modelValue:l.form.cookingTime,"onUpdate:modelValue":t[10]||(t[10]=a=>l.form.cookingTime=a),type:"number"},{append:o(()=>[r("分钟")]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:o(()=>[e(u,{label:"热量",prop:"calories"},{default:o(()=>[e(i,{modelValue:l.form.calories,"onUpdate:modelValue":t[11]||(t[11]=a=>l.form.calories=a),type:"number"},{append:o(()=>[r("卡路里")]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(x,null,{default:o(()=>[e(d,{span:8},{default:o(()=>[e(u,{label:"蛋白质",prop:"protein"},{default:o(()=>[e(i,{modelValue:l.form.protein,"onUpdate:modelValue":t[12]||(t[12]=a=>l.form.protein=a),type:"number"},{append:o(()=>[r("g")]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{span:8},{default:o(()=>[e(u,{label:"碳水化合物",prop:"carbohydrate"},{default:o(()=>[e(i,{modelValue:l.form.carbohydrate,"onUpdate:modelValue":t[13]||(t[13]=a=>l.form.carbohydrate=a),type:"number"},{append:o(()=>[r("g")]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{span:8},{default:o(()=>[e(u,{label:"脂肪",prop:"fat"},{default:o(()=>[e(i,{modelValue:l.form.fat,"onUpdate:modelValue":t[14]||(t[14]=a=>l.form.fat=a),type:"number"},{append:o(()=>[r("g")]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(u,{label:"食材清单",prop:"ingredients"},{default:o(()=>[e(i,{type:"textarea",rows:3,modelValue:l.form.ingredients,"onUpdate:modelValue":t[15]||(t[15]=a=>l.form.ingredients=a),placeholder:"每行一个食材，格式：食材名称 用量",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(u,{label:"烹饪步骤",prop:"steps"},{default:o(()=>[e(i,{type:"textarea",rows:4,modelValue:l.form.steps,"onUpdate:modelValue":t[16]||(t[16]=a=>l.form.steps=a),placeholder:"每行一个步骤",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),e(S,{title:"食谱详情",width:"60%",modelValue:l.detailVisible,"onUpdate:modelValue":t[21]||(t[21]=a=>l.detailVisible=a),"close-on-click-modal":!1},{footer:o(()=>[s("span",ll,[e(f,{onClick:t[20]||(t[20]=a=>l.detailVisible=!1)},{default:o(()=>[r("关 闭")]),_:1})])]),default:o(()=>[l.currentRecipe?(_(),y("div",ze,[e(x,{gutter:20},{default:o(()=>[e(d,{span:8},{default:o(()=>[e(C,{src:R(l.currentRecipe.image),style:{width:"100%","border-radius":"8px"},fallback:v,onError:t[19]||(t[19]=a=>I(a))},null,8,["src"])]),_:1}),e(d,{span:16},{default:o(()=>[s("h2",De,c(l.currentRecipe.name),1),s("p",Pe,c(l.currentRecipe.description),1),e(N),e(x,{gutter:20},{default:o(()=>[e(d,{span:6},{default:o(()=>[s("div",Te,[s("div",Oe,c(l.currentRecipe.cookingTime),1),Ae])]),_:1}),e(d,{span:6},{default:o(()=>[s("div",Fe,[s("div",Je,c(l.currentRecipe.calories),1),Be])]),_:1}),e(d,{span:6},{default:o(()=>[s("div",Le,[s("div",Me,c(l.currentRecipe.protein),1),$e])]),_:1}),e(d,{span:6},{default:o(()=>[s("div",je,[s("div",qe,c(l.currentRecipe.difficulty),1),Ge])]),_:1})]),_:1}),e(N),He,s("div",Ke,[(_(!0),y(z,null,D(l.currentRecipe.ingredients.split(`
`),(a,m)=>(_(),y("div",{key:m,style:{"margin-bottom":"5px"}},[e(W,{type:"success",size:"small"},{default:o(()=>[r(c(m+1),1)]),_:2},1024),s("span",Qe,c(a),1)]))),128))]),e(N),We,s("div",Xe,[(_(!0),y(z,null,D(l.currentRecipe.steps.split(`
`),(a,m)=>(_(),y("div",{key:m,style:{"margin-bottom":"15px"}},[s("div",Ye,[s("div",Ze,c(m+1),1),s("div",el,c(a),1)])]))),128))])]),_:1})]),_:1})])):E("",!0)]),_:1},8,["modelValue"])])}}},_l=X(tl,[["__scopeId","data-v-ac72c4f7"]]);export{_l as default};
