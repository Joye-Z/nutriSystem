import{_ as Ie,S as T,r as Q,T as ue,A as Ne,E as M,o as f,c as _,d as p,e as o,w as r,U as Pe,i as K,t as h,L as G,M as H,V as $e,h as W,z as Ae,W as ze,x as Ee,C as Fe,D as Ue,F as Ye,X as je,u as A,Y as ee,q as v,Z as Be,$ as Oe,a0 as qe,a1 as Re,a2 as Je,g as Le,G as Ke,a3 as Ge,k as He,H as We,R as Xe,y as Ze,O as Qe,P as el,a4 as ll,n as al,p as tl,j as ol}from"./index-07fe75f3.js";/* empty css                *//* empty css                   *//* empty css                    *//* empty css              *//* empty css               *//* empty css               *//* empty css                *//* empty css             */import{r as U}from"./request-c1aee9f6.js";const Y=O=>(tl("data-v-cc7bcaab"),O=O(),ol(),O),nl={style:{"margin-bottom":"20px",display:"flex","justify-content":"space-between","align-items":"center","background-color":"#f8f9fa",padding:"15px","border-radius":"8px"}},sl={style:{display:"flex",gap:"10px"}},rl={key:0,style:{display:"flex","align-items":"center",gap:"10px"}},il={key:0},cl={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"20px"}},ul={style:{margin:"0"}},dl={class:"calendar-container"},pl={class:"calendar-header"},gl={class:"calendar-body"},ml=["onClick"],fl={class:"day-number"},vl={key:0,class:"meal-indicators"},yl={key:1},_l={style:{"text-align":"center",padding:"50px",color:"#999"}},hl=Y(()=>p("div",{style:{"margin-top":"20px"}},"æš‚æ— è†³é£Ÿè®¡åˆ’æ•°æ®",-1)),Dl=Y(()=>p("div",{style:{"margin-top":"10px"}},'è¯·ç‚¹å‡»"æ–°å¢žè®¡åˆ’"æŒ‰é’®æ·»åŠ æ•°æ®',-1)),bl={key:0},wl={key:1},xl={style:{"margin-top":"20px",display:"flex","justify-content":"flex-end"}},Tl={class:"dialog-footer"},kl={key:0},Ml={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"20px"}},Vl={style:{margin:"0"}},Sl={key:0,style:{"text-align":"center",padding:"50px",color:"#999"}},Cl=Y(()=>p("div",{style:{"margin-bottom":"20px"}},"è¯¥æ—¥æœŸæš‚æ— è†³é£Ÿè®¡åˆ’",-1)),Il={key:0},Nl={key:1},Pl={key:1,style:{color:"#999"}},$l={key:2,style:{"margin-top":"20px",padding:"15px","background-color":"#f5f7fa","border-radius":"8px"}},Al={style:{display:"flex","justify-content":"space-around","text-align":"center"}},zl={style:{"font-size":"20px","font-weight":"bold",color:"#409eff"}},El=Y(()=>p("div",{style:{color:"#666","font-size":"12px"}},"æ€»è®¡åˆ’æ•°",-1)),Fl={style:{"font-size":"20px","font-weight":"bold",color:"#67c23a"}},Ul=Y(()=>p("div",{style:{color:"#666","font-size":"12px"}},"æ€»çƒ­é‡(å¡)",-1)),Yl={style:{"font-size":"20px","font-weight":"bold",color:"#e6a23c"}},jl=Y(()=>p("div",{style:{color:"#666","font-size":"12px"}},"å¹³å‡çƒ­é‡(å¡)",-1)),Bl={__name:"MealPlan",setup(O){const b=T([]),k=T([]),j=T([]),z=T(!1),C=T(!1),E=T(),m=T("calendar"),q=T(""),V=T(null),R=T(!1),S=T(1),B=T(10),J=T(0),y=Q({planName:"",planDate:"",mealType:""}),s=Q({id:null,planName:"",planDate:"",mealType:"",recipeId:null,customMeal:"",calories:null,notes:""}),de=Q({planName:[{required:!0,message:"è¯·è¾“å…¥è®¡åˆ’åç§°",trigger:"blur"}],planDate:[{required:!0,message:"è¯·é€‰æ‹©è®¡åˆ’æ—¥æœŸ",trigger:"change"}],mealType:[{required:!0,message:"è¯·é€‰æ‹©é¤æ¬¡ç±»åž‹",trigger:"change"}]}),le=T(""),w=T(new Date),pe=ue(()=>{const l=w.value.getFullYear(),e=w.value.getMonth(),c=new Date(l,e,1),i=new Date(c);i.setDate(i.getDate()-c.getDay());const d=[];for(let u=0;u<42;u++){const t=new Date(i);t.setDate(i.getDate()+u);const n=t.getDate(),g=t.getMonth()===e,N=t.toDateString()===new Date().toDateString(),x=`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`,P=$=>{if(!$)return"";let F=$;return F.includes("T")&&(F=F.split("T")[0]),F},L=b.value.some($=>P($.planDate)===x),Z=b.value.filter($=>P($.planDate)===x).map($=>$.mealType);d.push({date:x,day:n,isCurrentMonth:g,isToday:N,hasPlan:L,mealTypes:Z})}return d});Ne(()=>{X(),I(),ge()});const X=()=>{const l=w.value.getFullYear(),e=w.value.getMonth()+1;le.value=`${l}å¹´${e}æœˆ`},I=async()=>{if(console.log("ðŸ”„ åŠ è½½æ•°æ®å¼€å§‹ï¼Œå½“å‰è§†å›¾æ¨¡å¼:",m.value),R.value){console.log("âš ï¸ æ•°æ®æ­£åœ¨åŠ è½½ä¸­ï¼Œè·³è¿‡é‡å¤è¯·æ±‚");return}R.value=!0;try{const l=JSON.parse(localStorage.getItem("system-user")||"{}");if(!l.id){console.error("ç”¨æˆ·IDä¸å­˜åœ¨ï¼Œè¯·å…ˆç™»å½•"),M.error("è¯·å…ˆç™»å½•");return}console.log("å½“å‰è§†å›¾æ¨¡å¼:",m.value),console.log("å½“å‰æœç´¢æ¡ä»¶:",y),console.log("å½“å‰åˆ†é¡µå‚æ•° - pageNum:",S.value,"pageSize:",B.value),console.log("å½“å‰tableDataé•¿åº¦:",b.value.length);const e={userId:l.id};if(y.planName&&y.planName.trim()&&(e.planName=y.planName.trim(),console.log("æ·»åŠ è®¡åˆ’åç§°ç­›é€‰æ¡ä»¶:",e.planName)),y.planDate&&(e.planDate=y.planDate,console.log("æ·»åŠ æ—¥æœŸç­›é€‰æ¡ä»¶:",e.planDate)),y.mealType&&(e.mealType=y.mealType,console.log("æ·»åŠ é¤æ¬¡ç±»åž‹ç­›é€‰æ¡ä»¶:",e.mealType)),m.value==="calendar"){console.log("æ—¥åŽ†è§†å›¾æ¨¡å¼ï¼šèŽ·å–æ‰€æœ‰æ•°æ®ï¼ˆä¸åˆ†é¡µï¼‰");const u={...e};console.log("æ—¥åŽ†è§†å›¾APIå‚æ•°:",u);const t=await U.get("/mealPlan/selectByUser",{params:u});console.log("æ—¥åŽ†è§†å›¾å®Œæ•´APIå“åº”:",t);let n=[];t&&t.data?t.data.list&&Array.isArray(t.data.list)?(n=t.data.list,console.log("åˆ†é¡µæ•°æ®ç»“æž„ï¼šä½¿ç”¨listå­—æ®µï¼Œæ•°æ®é•¿åº¦:",n.length)):Array.isArray(t.data)?(n=t.data,console.log("éžåˆ†é¡µæ•°æ®ç»“æž„ï¼šç›´æŽ¥è¿”å›žæ•°ç»„ï¼Œæ•°æ®é•¿åº¦:",n.length)):t.data.data&&Array.isArray(t.data.data)&&(n=t.data.data,console.log("åµŒå¥—æ•°æ®ç»“æž„ï¼šä½¿ç”¨dataå­—æ®µï¼Œæ•°æ®é•¿åº¦:",n.length)):console.log("âŒ APIå“åº”æ— æ•ˆ:",t),console.log("æ—¥åŽ†è§†å›¾è§£æžåŽçš„å®žé™…æ•°æ®:",n),console.log("æ—¥åŽ†è§†å›¾æ•°æ®é•¿åº¦:",n.length),n&&n.length>=0?(b.value=n,J.value=n.length,console.log("âœ… æ—¥åŽ†æ•°æ®æ›´æ–°æˆåŠŸ")):console.log("âš ï¸ æ—¥åŽ†æ•°æ®ä¸ºç©ºï¼Œä¿æŒåŽŸçŠ¶"),w.value=new Date(w.value.getTime()),console.log("æ—¥åŽ†è§†å›¾æ•°æ®åŠ è½½å®Œæˆï¼Œå¼ºåˆ¶åˆ·æ–°æ—¥åŽ†æ˜¾ç¤º")}else{console.log("åˆ—è¡¨è§†å›¾æ¨¡å¼ï¼šä½¿ç”¨åˆ†é¡µæŸ¥è¯¢");const u={...e,pageNum:S.value,pageSize:B.value};console.log("åˆ—è¡¨è§†å›¾APIå‚æ•°:",u);const t=await U.get("/mealPlan/selectByUser",{params:u});console.log("åˆ—è¡¨è§†å›¾å®Œæ•´APIå“åº”:",t);let n=[],g=0;t&&t.data?t.data.list&&Array.isArray(t.data.list)?(n=t.data.list,g=t.data.total||0,console.log("æ ‡å‡†åˆ†é¡µå“åº”ç»“æž„ï¼Œæ•°æ®é•¿åº¦:",n.length,"æ€»æ•°:",g)):Array.isArray(t.data)?(n=t.data,g=t.data.length,console.log("å‘åŽå…¼å®¹ï¼šç›´æŽ¥è¿”å›žæ•°ç»„ï¼Œæ•°æ®é•¿åº¦:",n.length,"æ€»æ•°:",g)):t.data.data&&Array.isArray(t.data.data)&&(n=t.data.data,g=t.data.total||t.data.data.length,console.log("åµŒå¥—åˆ†é¡µç»“æž„ï¼Œæ•°æ®é•¿åº¦:",n.length,"æ€»æ•°:",g)):console.log("âŒ APIå“åº”æ— æ•ˆ:",t),console.log("åˆ—è¡¨è§†å›¾è§£æžåŽçš„å®žé™…æ•°æ®:",n),console.log("åˆ—è¡¨è§†å›¾æ•°æ®é•¿åº¦:",n.length),console.log("åˆ—è¡¨è§†å›¾æ€»æ•°:",g),n&&n.length>=0?(b.value=n,J.value=g,console.log("âœ… åˆ—è¡¨æ•°æ®æ›´æ–°æˆåŠŸ")):console.log("âš ï¸ åˆ—è¡¨æ•°æ®ä¸ºç©ºï¼Œä¿æŒåŽŸçŠ¶"),console.log("åˆ—è¡¨è§†å›¾åˆ†é¡µæ•°æ®åŠ è½½å®Œæˆ")}console.log("=== æ•°æ®ä¸€è‡´æ€§éªŒè¯ ==="),console.log("å½“å‰è§†å›¾æ¨¡å¼:",m.value),console.log("tableData é•¿åº¦:",b.value.length),console.log("total æ€»æ•°:",J.value);const c=new Date,i=`${c.getFullYear()}-${(c.getMonth()+1).toString().padStart(2,"0")}-${c.getDate().toString().padStart(2,"0")}`,d=b.value.some(u=>{if(!u.planDate)return!1;let t=u.planDate;return t.includes("T")&&(t=t.split("T")[0]),t===i});console.log("ä»Šæ—¥æ˜¯å¦æœ‰è®¡åˆ’:",d),console.log("=== éªŒè¯å®Œæˆ ===")}catch(l){console.error("åŠ è½½æ•°æ®é”™è¯¯è¯¦æƒ…:",l),console.error("é”™è¯¯å“åº”:",l.response),console.error("é”™è¯¯çŠ¶æ€:",l.status),l.response?M.error(`åŠ è½½å¤±è´¥: ${l.response.status} ${l.response.statusText}`):l.request?M.error("ç½‘ç»œè¿žæŽ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åŽç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ"):M.error("åŠ è½½æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥æŽ§åˆ¶å°æ—¥å¿—")}finally{R.value=!1}},ge=async()=>{var l;try{const e=await U.get("/recipe/selectAll");j.value=((l=e==null?void 0:e.data)==null?void 0:l.list)||(e==null?void 0:e.data)||[]}catch(e){console.error("åŠ è½½é£Ÿè°±åˆ—è¡¨å¤±è´¥:",e)}},me=async()=>{console.log("åˆ‡æ¢è§†å›¾æ¨¡å¼ï¼Œå½“å‰è§†å›¾:",m.value),console.log("åˆ‡æ¢å‰ tableData é•¿åº¦:",b.value.length),console.log("å½“å‰æœç´¢æ¡ä»¶:",y);const l=m.value;m.value=m.value==="calendar"?"list":"calendar",console.log("åˆ‡æ¢åŽè§†å›¾:",m.value),l==="calendar"&&m.value==="list"?(console.log("ä»Žæ—¥åŽ†åˆ‡æ¢åˆ°åˆ—è¡¨ï¼Œé‡æ–°åŠ è½½åˆ†é¡µæ•°æ®..."),S.value=1,console.log("åˆ—è¡¨è§†å›¾æœç´¢æ¡ä»¶:",y),await I(),console.log("åˆ—è¡¨è§†å›¾æ•°æ®é‡æ–°åŠ è½½å®Œæˆ")):l==="list"&&m.value==="calendar"&&(console.log("ä»Žåˆ—è¡¨åˆ‡æ¢åˆ°æ—¥åŽ†ï¼Œé‡æ–°åŠ è½½æ‰€æœ‰æ•°æ®..."),await I(),w.value=new Date(w.value.getTime()),console.log("æ—¥åŽ†è§†å›¾å¼ºåˆ¶åˆ·æ–°å®Œæˆ")),console.log("åˆ‡æ¢åŽ tableData é•¿åº¦:",b.value.length),console.log("=== æ•°æ®ä¸€è‡´æ€§éªŒè¯ ===");const e=new Date,c=`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`;console.log("ä»Šæ—¥æ—¥æœŸå­—ç¬¦ä¸²:",c);const i=b.value.some(d=>{if(!d.planDate)return!1;let u=d.planDate;return u.includes("T")&&(u=u.split("T")[0]),u===c});console.log("ä»Šæ—¥æ˜¯å¦æœ‰è®¡åˆ’:",i),console.log("=== éªŒè¯å®Œæˆ ==="),console.log("è§†å›¾åˆ‡æ¢å®Œæˆï¼Œæ•°æ®å·²åŒæ­¥")},fe=l=>{if(l){const e=l.getFullYear(),c=(l.getMonth()+1).toString().padStart(2,"0"),i=l.getDate().toString().padStart(2,"0");y.planDate=`${e}-${c}-${i}`,console.log("é€‰æ‹©çš„æ—¥æœŸ:",l,"æ ¼å¼åŒ–åŽçš„æ—¥æœŸ:",y.planDate)}else y.planDate="",C.value=!1,console.log("æ—¥æœŸå·²æ¸…ç©º")},ae=async l=>{try{if(!JSON.parse(localStorage.getItem("system-user")||"{}").id){M.error("è¯·å…ˆç™»å½•");return}console.log("æŸ¥çœ‹æŒ‡å®šæ—¥æœŸè®¡åˆ’:",l);const c=d=>{if(!d)return"";let u=d;return u.includes("T")&&(u=u.split("T")[0]),u},i=b.value.filter(d=>c(d.planDate)===l);console.log("æ‰¾åˆ°çš„æ—¥æœŸè®¡åˆ’:",i),console.log("æœç´¢çš„æ—¥æœŸ:",l,"æ•°æ®é•¿åº¦:",i.length),i.length>0?(V.value={date:l,isCurrentMonth:!0,hasPlan:!0,mealTypes:i.map(d=>d.mealType)},k.value=i,C.value=!0,console.log("æ˜¾ç¤ºæ—¥æœŸè¯¦æƒ…å¯¹è¯æ¡†")):(V.value={date:l,isCurrentMonth:!0,hasPlan:!1,mealTypes:[]},k.value=[],C.value=!0,console.log("æ˜¾ç¤ºç©ºæ—¥æœŸè¯¦æƒ…å¯¹è¯æ¡†:",l))}catch(e){console.error("æ˜¾ç¤ºæ—¥æœŸè®¡åˆ’è¯¦æƒ…å¤±è´¥:",e),M.error("èŽ·å–æ—¥æœŸè®¡åˆ’è¯¦æƒ…å¤±è´¥")}},te=async()=>{console.log("æ‰§è¡Œæœç´¢æ“ä½œï¼Œæœç´¢æ¡ä»¶:",y),S.value=1,await I()},ve=()=>{y.planName="",y.planDate="",y.mealType="",q.value="",S.value=1,C.value=!1,I()},ye=()=>{Object.keys(s).forEach(l=>{s[l]=""}),s.id=null,z.value=!0},oe=l=>{console.log("ç¼–è¾‘åŽŸå§‹æ•°æ®:",l),Object.keys(s).forEach(e=>{s[e]=""}),s.id=l.id,s.planName=l.planName||"",s.planDate=l.planDate||"",s.mealType=l.mealType||"",s.recipeId=l.recipeId||null,s.customMeal=l.customMeal||"",s.calories=l.calories||null,s.notes=l.notes||"",s.planDate&&(s.planDate=new Date(s.planDate)),console.log("ç¼–è¾‘è¡¨å•æ•°æ®:",s),z.value=!0},ne=(l,e,c)=>{if(e||c)return e||c;if(l&&j.value.length>0){const i=j.value.find(d=>d.id===l);if(i)return i.name}return"æœªå‘½åé£Ÿè°±"},se=async l=>{var e;try{await Ke.confirm("ç¡®è®¤åˆ é™¤è¯¥è†³é£Ÿè®¡åˆ’å—ï¼Ÿ","æç¤º",{type:"warning"});const c=m.value,i=C.value,d=(e=V.value)==null?void 0:e.date;await U.delete(`/mealPlan/delete/${l}`),M.success("åˆ é™¤æˆåŠŸ"),await I(),i&&d&&(console.log("åˆ é™¤åŽåˆ·æ–°æ—¥æœŸè¯¦æƒ…"),await ae(d))}catch(c){c!=="cancel"&&M.error("åˆ é™¤å¤±è´¥")}},_e=async()=>{var l;if(E.value)try{await E.value.validate();const e=JSON.parse(localStorage.getItem("system-user")||"{}");s.userId=e.id;let c=s.planDate;if(s.planDate&&s.planDate instanceof Date){const N=s.planDate.getFullYear(),x=(s.planDate.getMonth()+1).toString().padStart(2,"0"),P=s.planDate.getDate().toString().padStart(2,"0");c=`${N}-${x}-${P}`}const i=c;let d="";if(s.recipeId){const N=j.value.find(x=>x.id===s.recipeId);N&&(d=N.name)}const u={id:s.id,userId:e.id,planName:s.planName,planDate:c,mealType:s.mealType,recipeId:s.recipeId||null,recipeName:d,customMeal:s.customMeal||"",calories:s.calories||null,notes:s.notes||""};console.log("æäº¤è¡¨å•æ•°æ®:",u),console.log("å½“å‰è§†å›¾æ¨¡å¼:",m.value),console.log("æäº¤çš„æ—¥æœŸ:",i),s.id?(await U.put("/mealPlan/update",u),M.success("ä¿®æ”¹æˆåŠŸ")):(await U.post("/mealPlan/add",u),M.success("æ–°å¢žæˆåŠŸ")),z.value=!1;const t=m.value,n=C.value,g=(l=V.value)==null?void 0:l.date;console.log("ä¿å­˜å½“å‰è§†å›¾æ¨¡å¼:",t),console.log("æ˜¯å¦æ˜¾ç¤ºæ—¥æœŸè¯¦æƒ…:",n),console.log("å½“å‰è¯¦æƒ…æ—¥æœŸ:",g),t==="calendar"?(S.value=1,await I(),w.value=new Date(w.value.getTime()),console.log("æ—¥åŽ†è§†å›¾å¼ºåˆ¶åˆ·æ–°å®Œæˆ")):(S.value=1,await I(),console.log("åˆ—è¡¨è§†å›¾æ•°æ®é‡æ–°åŠ è½½å®Œæˆ")),n&&g===i&&(console.log("åˆ·æ–°æ—¥æœŸè¯¦æƒ…å¯¹è¯æ¡†"),await ae(g)),console.log("æ“ä½œåŽè§†å›¾æ¨¡å¼:",m.value),m.value!==t&&(console.warn("âš ï¸ è­¦å‘Šï¼šè§†å›¾æ¨¡å¼è¢«æ„å¤–ä¿®æ”¹ï¼ä»Ž",t,"å˜ä¸ºäº†",m.value),await Ge(),m.value=t,console.log("âœ… å·²æ¢å¤æ­£ç¡®çš„è§†å›¾æ¨¡å¼:",t)),E.value&&E.value.resetFields()}catch(e){console.error("è¡¨å•æäº¤å¤±è´¥:",e),M.error("æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•")}},he=()=>{console.log("å¯¹è¯æ¡†å…³é—­äº‹ä»¶è§¦å‘ï¼Œå½“å‰è§†å›¾æ¨¡å¼:",m.value),E.value&&E.value.resetFields(),console.log("å¯¹è¯æ¡†å…³é—­å®Œæˆï¼Œè§†å›¾æ¨¡å¼ä¿æŒä¸º:",m.value)},De=l=>{B.value=l,S.value=1,I()},be=l=>{S.value=l,I()},we=()=>{w.value=new Date(w.value.getFullYear(),w.value.getMonth()-1,1),X()},xe=()=>{w.value=new Date(w.value.getFullYear(),w.value.getMonth()+1,1),X()},Te=async l=>{if(l.isCurrentMonth){V.value=l;try{const e=JSON.parse(localStorage.getItem("system-user")||"{}");if(!e.id){M.error("è¯·å…ˆç™»å½•");return}const c=l.date;console.log("æŸ¥çœ‹æ—¥è®¡åˆ’ï¼ŒåŽŸæ—¥æœŸ:",l.date,"å¤„ç†åŽçš„æ—¥æœŸ:",c);const i=t=>{if(!t)return"";let n=t;return n.includes("T")&&(n=n.split("T")[0]),n},d=b.value.filter(t=>i(t.planDate)===c);console.log("ä»Žæœ¬åœ°æ•°æ®ä¸­æ‰¾åˆ°çš„æ—¥è®¡åˆ’:",d);let u=d;if(d.length===0){console.log("æœ¬åœ°æ•°æ®ä¸ºç©ºï¼Œè°ƒç”¨APIèŽ·å–æ—¥è®¡åˆ’...");const t={userId:e.id,planDate:c};console.log("æ—¥è®¡åˆ’APIå‚æ•°:",t);const n=await U.get("/mealPlan/selectByUser",{params:t});console.log("æ—¥è®¡åˆ’APIå“åº”:",n);let g=[];n&&n.data&&(n.data.list&&Array.isArray(n.data.list)?(g=n.data.list,console.log("æ—¥è®¡åˆ’ï¼šåˆ†é¡µæ•°æ®ç»“æž„")):Array.isArray(n.data)?(g=n.data,console.log("æ—¥è®¡åˆ’ï¼šéžåˆ†é¡µæ•°æ®ç»“æž„")):n.data.data&&Array.isArray(n.data.data)&&(g=n.data.data,console.log("æ—¥è®¡åˆ’ï¼šåµŒå¥—æ•°æ®ç»“æž„"))),console.log("APIèŽ·å–åˆ°çš„æ—¥è®¡åˆ’æ•°æ®:",g),u=g.filter(N=>i(N.planDate)===c)}if(console.log("æœ€ç»ˆæ—¥è®¡åˆ’æ•°æ®:",u),k.value=u,C.value=!0,d.length===0&&u.length>0){console.log("æ›´æ–°æœ¬åœ°æ•°æ®ä»¥ç¡®ä¿åŒæ­¥");const t=new Set(b.value.map(g=>g.id)),n=u.filter(g=>!t.has(g.id));n.length>0&&(b.value=[...b.value,...n])}}catch(e){M.error("åŠ è½½æ—¥è®¡åˆ’å¤±è´¥"),console.error("æŸ¥çœ‹æ—¥è®¡åˆ’é”™è¯¯:",e),e.response&&(console.error("é”™è¯¯å“åº”çŠ¶æ€:",e.response.status),console.error("é”™è¯¯å“åº”æ•°æ®:",e.response.data))}}},ke=l=>{if(!l)return"";let e;if(l.includes("T"))e=new Date(l);else if(l.includes("-")){const[c,i,d]=l.split("-").map(Number);e=new Date(c,i-1,d)}else e=new Date(l);return`${e.getMonth()+1}æœˆ${e.getDate()}æ—¥`},re=l=>{if(!l)return"";let e;if(l.includes("T"))e=new Date(l);else if(l.includes("-")){const[u,t,n]=l.split("-").map(Number);e=new Date(u,t-1,n)}else e=new Date(l);const c=e.getFullYear(),i=e.getMonth()+1,d=e.getDate();return`${c}å¹´${i}æœˆ${d}æ—¥`},ie=l=>({æ—©é¤:"success",åˆé¤:"warning",æ™šé¤:"danger",åŠ é¤:"info"})[l]||"info",Me=l=>({æ—©é¤:"ðŸŒ…",åˆé¤:"â˜€ï¸",æ™šé¤:"ðŸŒ™",åŠ é¤:"ðŸŽ"})[l]||"ðŸ½ï¸",ce=l=>{console.log("ä¸ºæŒ‡å®šæ—¥æœŸæ·»åŠ è®¡åˆ’:",l),Object.keys(s).forEach(e=>{s[e]=""}),s.id=null,s.planDate=new Date(l),q.value=new Date(l),console.log("è®¾ç½®è¡¨å•æ—¥æœŸ:",s.planDate),z.value=!0},Ve=()=>{C.value=!1,V.value=null,k.value=[]},Se=ue(()=>s.id?"ç¼–è¾‘è†³é£Ÿè®¡åˆ’":"æ–°å¢žè†³é£Ÿè®¡åˆ’");return(l,e)=>{const c=He,i=Ae,d=ze,u=Ee,t=We,n=Xe,g=Fe,N=Ue,x=Ze,P=Qe,L=el,Z=ll,$=al,F=Ye,Ce=je;return f(),_("div",null,[p("div",nl,[p("div",sl,[o(i,{type:"success",onClick:ye},{default:r(()=>[o(c,null,{default:r(()=>[o(A(ee))]),_:1}),v(" æ–°å¢žè®¡åˆ’ ")]),_:1}),o(i,{onClick:me},{default:r(()=>[v(h(m.value==="calendar"?"åˆ—è¡¨è§†å›¾":"æ—¥åŽ†è§†å›¾"),1)]),_:1})]),m.value!=="calendar"?(f(),_("div",rl,[o(d,{modelValue:q.value,"onUpdate:modelValue":e[0]||(e[0]=a=>q.value=a),type:"date",placeholder:"é€‰æ‹©æ—¥æœŸ",onChange:fe,style:{width:"150px"}},null,8,["modelValue"]),o(u,{modelValue:y.planName,"onUpdate:modelValue":e[1]||(e[1]=a=>y.planName=a),placeholder:"è¯·è¾“å…¥è®¡åˆ’åç§°",style:{width:"200px"},onKeyup:Pe(te,["enter"])},null,8,["modelValue","onKeyup"]),o(i,{type:"primary",onClick:te},{default:r(()=>[o(c,null,{default:r(()=>[o(A(Be))]),_:1}),v(" æœç´¢ ")]),_:1}),o(i,{onClick:ve},{default:r(()=>[v("é‡ç½®")]),_:1})])):K("",!0)]),m.value==="calendar"?(f(),_("div",il,[p("div",cl,[o(i,{onClick:we},{default:r(()=>[o(c,null,{default:r(()=>[o(A(Oe))]),_:1}),v(" ä¸Šä¸ªæœˆ ")]),_:1}),p("h3",ul,h(le.value),1),o(i,{onClick:xe},{default:r(()=>[v(" ä¸‹ä¸ªæœˆ "),o(c,null,{default:r(()=>[o(A(qe))]),_:1})]),_:1})]),p("div",dl,[p("div",pl,[(f(),_(G,null,H(["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],a=>p("div",{class:"calendar-header-cell",key:a},h(a),1)),64))]),p("div",gl,[(f(!0),_(G,null,H(pe.value,a=>(f(),_("div",{key:a.date,class:Re(["calendar-day",{"current-month":a.isCurrentMonth,today:a.isToday,"has-plan":a.hasPlan}]),onClick:D=>Te(a)},[p("div",fl,h(a.day),1),a.hasPlan?(f(),_("div",vl,[(f(!0),_(G,null,H(a.mealTypes,D=>(f(),_("span",{key:D,class:"meal-indicator"},h(Me(D)),1))),128))])):K("",!0)],10,ml))),128))])])])):(f(),_("div",yl,[$e((f(),W(g,{data:b.value,stripe:"",style:{width:"100%"}},{empty:r(()=>[p("div",_l,[o(c,{size:"50"},{default:r(()=>[o(A(Je))]),_:1}),hl,Dl])]),default:r(()=>[o(t,{prop:"planDate",label:"æ—¥æœŸ",width:"120"},{default:r(({row:a})=>[v(h(ke(a.planDate)),1)]),_:1}),o(t,{prop:"planName",label:"è®¡åˆ’åç§°",width:"150"}),o(t,{prop:"mealType",label:"é¤æ¬¡ç±»åž‹",width:"100"},{default:r(({row:a})=>[o(n,{type:ie(a.mealType)},{default:r(()=>[v(h(a.mealType),1)]),_:2},1032,["type"])]),_:1}),o(t,{prop:"recipeName",label:"é£Ÿè°±",width:"200"},{default:r(({row:a})=>{var D;return[a.recipeId||a.recipe||a.recipeName?(f(),_("div",bl,h(ne(a.recipeId,(D=a.recipe)==null?void 0:D.name,a.recipeName)),1)):(f(),_("div",wl,h(a.customMeal||"è‡ªå®šä¹‰é¤é£Ÿ"),1))]}),_:1}),o(t,{prop:"calories",label:"çƒ­é‡(å¡è·¯é‡Œ)",width:"120"}),o(t,{prop:"notes",label:"å¤‡æ³¨","show-overflow-tooltip":""}),o(t,{label:"æ“ä½œ",width:"180",fixed:"right"},{default:r(({row:a})=>[o(i,{type:"primary",size:"small",onClick:D=>oe(a)},{default:r(()=>[v("ç¼–è¾‘")]),_:2},1032,["onClick"]),o(i,{type:"danger",size:"small",onClick:D=>se(a.id)},{default:r(()=>[v("åˆ é™¤")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ce,R.value]]),p("div",xl,[o(N,{"current-page":S.value,"onUpdate:currentPage":e[2]||(e[2]=a=>S.value=a),"page-size":B.value,"onUpdate:pageSize":e[3]||(e[3]=a=>B.value=a),"page-sizes":[5,10,20,50],total:J.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:De,onCurrentChange:be},null,8,["current-page","page-size","total"])])])),o(F,{modelValue:z.value,"onUpdate:modelValue":e[12]||(e[12]=a=>z.value=a),title:Se.value,width:"600px",onClose:he},{footer:r(()=>[p("span",Tl,[o(i,{onClick:e[11]||(e[11]=a=>z.value=!1)},{default:r(()=>[v("å–æ¶ˆ")]),_:1}),o(i,{type:"primary",onClick:_e},{default:r(()=>[v("ç¡®å®š")]),_:1})])]),default:r(()=>[o($,{model:s,rules:de,ref_key:"formRef",ref:E,"label-width":"100px"},{default:r(()=>[o(x,{label:"è®¡åˆ’åç§°",prop:"planName"},{default:r(()=>[o(u,{modelValue:s.planName,"onUpdate:modelValue":e[4]||(e[4]=a=>s.planName=a),placeholder:"è¯·è¾“å…¥è®¡åˆ’åç§°"},null,8,["modelValue"])]),_:1}),o(x,{label:"è®¡åˆ’æ—¥æœŸ",prop:"planDate"},{default:r(()=>[o(d,{modelValue:s.planDate,"onUpdate:modelValue":e[5]||(e[5]=a=>s.planDate=a),type:"date",placeholder:"é€‰æ‹©æ—¥æœŸ",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(x,{label:"é¤æ¬¡ç±»åž‹",prop:"mealType"},{default:r(()=>[o(L,{modelValue:s.mealType,"onUpdate:modelValue":e[6]||(e[6]=a=>s.mealType=a),placeholder:"è¯·é€‰æ‹©é¤æ¬¡ç±»åž‹",style:{width:"100%"}},{default:r(()=>[o(P,{label:"æ—©é¤",value:"æ—©é¤"}),o(P,{label:"åˆé¤",value:"åˆé¤"}),o(P,{label:"æ™šé¤",value:"æ™šé¤"}),o(P,{label:"åŠ é¤",value:"åŠ é¤"})]),_:1},8,["modelValue"])]),_:1}),o(x,{label:"é€‰æ‹©é£Ÿè°±",prop:"recipeId"},{default:r(()=>[o(L,{modelValue:s.recipeId,"onUpdate:modelValue":e[7]||(e[7]=a=>s.recipeId=a),placeholder:"è¯·é€‰æ‹©é£Ÿè°±",style:{width:"100%"},filterable:""},{default:r(()=>[(f(!0),_(G,null,H(j.value,a=>(f(),W(P,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(x,{label:"è‡ªå®šä¹‰é¤é£Ÿ",prop:"customMeal"},{default:r(()=>[o(u,{modelValue:s.customMeal,"onUpdate:modelValue":e[8]||(e[8]=a=>s.customMeal=a),type:"textarea",rows:3,placeholder:"å¦‚ä¸é€‰æ‹©é£Ÿè°±ï¼Œå¯åœ¨æ­¤è¾“å…¥è‡ªå®šä¹‰é¤é£Ÿå†…å®¹"},null,8,["modelValue"])]),_:1}),o(x,{label:"çƒ­é‡",prop:"calories"},{default:r(()=>[o(Z,{modelValue:s.calories,"onUpdate:modelValue":e[9]||(e[9]=a=>s.calories=a),min:0,max:5e3,placeholder:"è¯·è¾“å…¥çƒ­é‡",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(x,{label:"å¤‡æ³¨",prop:"notes"},{default:r(()=>[o(u,{modelValue:s.notes,"onUpdate:modelValue":e[10]||(e[10]=a=>s.notes=a),type:"textarea",rows:2,placeholder:"è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),o(F,{modelValue:C.value,"onUpdate:modelValue":e[15]||(e[15]=a=>C.value=a),title:`${V.value?re(V.value.date)+" çš„è†³é£Ÿè®¡åˆ’":"æ—¥è®¡åˆ’è¯¦æƒ…"}`,width:"900px",onClose:Ve},{default:r(()=>[V.value?(f(),_("div",kl,[p("div",Ml,[p("h3",Vl,[v(h(re(V.value.date))+" çš„è†³é£Ÿè®¡åˆ’ ",1),o(n,{type:k.value.length>0?"success":"info",style:{"margin-left":"10px"}},{default:r(()=>[v(h(k.value.length)+" ä¸ªè®¡åˆ’ ",1)]),_:1},8,["type"])]),p("div",null,[o(i,{type:"primary",size:"small",onClick:e[13]||(e[13]=a=>ce(V.value.date))},{default:r(()=>[o(c,null,{default:r(()=>[o(A(ee))]),_:1}),v(" ä¸ºè¯¥æ—¥æ·»åŠ è®¡åˆ’ ")]),_:1})])]),k.value.length===0?(f(),_("div",Sl,[o(c,{size:"50",style:{"margin-bottom":"20px"}},{default:r(()=>[o(A(Le))]),_:1}),Cl,o(i,{type:"primary",onClick:e[14]||(e[14]=a=>ce(V.value.date))},{default:r(()=>[o(c,null,{default:r(()=>[o(A(ee))]),_:1}),v(" æ·»åŠ ç¬¬ä¸€ä¸ªè®¡åˆ’ ")]),_:1})])):(f(),W(g,{key:1,data:k.value,stripe:""},{default:r(()=>[o(t,{prop:"mealType",label:"é¤æ¬¡ç±»åž‹",width:"100"},{default:r(({row:a})=>[o(n,{type:ie(a.mealType)},{default:r(()=>[v(h(a.mealType),1)]),_:2},1032,["type"])]),_:1}),o(t,{prop:"recipeName",label:"é¤é£Ÿå†…å®¹",width:"350"},{default:r(({row:a})=>{var D;return[a.recipeId||a.recipe||a.recipeName?(f(),_("div",Il,h(ne(a.recipeId,(D=a.recipe)==null?void 0:D.name,a.recipeName)),1)):(f(),_("div",Nl,h(a.customMeal||"è‡ªå®šä¹‰é¤é£Ÿ"),1))]}),_:1}),o(t,{prop:"calories",label:"çƒ­é‡",width:"100"},{default:r(({row:a})=>[a.calories?(f(),W(n,{key:0,type:"warning"},{default:r(()=>[v(h(a.calories)+" å¡",1)]),_:2},1024)):(f(),_("span",Pl,"æœªè®¾ç½®"))]),_:1}),o(t,{prop:"notes",label:"å¤‡æ³¨","show-overflow-tooltip":""}),o(t,{label:"æ“ä½œ",width:"160",fixed:"right"},{default:r(({row:a})=>[o(i,{type:"primary",size:"small",onClick:D=>oe(a)},{default:r(()=>[v("ç¼–è¾‘")]),_:2},1032,["onClick"]),o(i,{type:"danger",size:"small",onClick:D=>se(a.id)},{default:r(()=>[v("åˆ é™¤")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),k.value.length>0?(f(),_("div",$l,[p("div",Al,[p("div",null,[p("div",zl,h(k.value.length),1),El]),p("div",null,[p("div",Fl,h(k.value.reduce((a,D)=>a+(D.calories||0),0)),1),Ul]),p("div",null,[p("div",Yl,h(Math.round(k.value.reduce((a,D)=>a+(D.calories||0),0)/k.value.length)||0),1),jl])])])):K("",!0)])):K("",!0)]),_:1},8,["modelValue","title"])])}}},Zl=Ie(Bl,[["__scopeId","data-v-cc7bcaab"]]);export{Zl as default};
