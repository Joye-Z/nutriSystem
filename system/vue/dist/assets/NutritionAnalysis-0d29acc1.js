import{_ as P,S as D,r as k,A as x,o as V,c as E,e as a,w as n,V as S,E as v,a5 as q,X as H,q as C,d,t as y,p as U,j as O,x as J,y as G,N as j,a6 as z,a7 as X,O as K,P as Q,J as W,z as Y,n as Z,a8 as $,H as ee,C as te,a9 as ae,aa as le}from"./index-c7857d1d.js";/* empty css                *//* empty css                    *//* empty css                *//* empty css               *//* empty css               *//* empty css              *//* empty css            */import{r as b}from"./request-2e544c9a.js";const oe={name:"NutritionAnalysis",setup(){const g=D("healthData"),s=D(!1),N=D(),o=D(!1),e=k({height:null,weight:null,age:null,gender:"男",activityLevel:"中度",goal:"维持健康"}),R={height:[{required:!0,message:"请输入身高",trigger:"blur"},{type:"number",message:"身高应在100-250cm之间",trigger:"change",validator:(t,l,i)=>{l==null||l===""?i():l<100||l>250?i(new Error("身高应在100-250cm之间")):i()}}],weight:[{required:!0,message:"请输入体重",trigger:"blur"},{type:"number",message:"体重应在30-300kg之间",trigger:"change",validator:(t,l,i)=>{l==null||l===""?i():l<30||l>300?i(new Error("体重应在30-300kg之间")):i()}}],age:[{required:!0,message:"请输入年龄",trigger:"blur"},{type:"number",message:"年龄应在1-150之间",trigger:"change",validator:(t,l,i)=>{l==null||l===""?i():l<1||l>150?i(new Error("年龄应在1-150之间")):i()}}],gender:[{required:!1,message:"请选择性别",trigger:"change"}],activityLevel:[{required:!1,message:"请选择活动水平",trigger:"change"}],goal:[{required:!1,message:"请选择健康目标",trigger:"change"}]},c=D(null),_=t=>{g.value=t.paneName,console.log("标签页切换到:",g.value),g.value==="nutritionAnalysis"&&(console.log("切换到营养分析标签页，检查是否有营养计划"),c.value||(console.log("没有营养计划，尝试计算"),p()))},p=async()=>{try{await N.value.validate(),s.value=!0;const t=await b.post("/nutritionAnalysis/nutritionPlan",e);if(t&&t.code==="200"){c.value=t.data;const l=e.height/100,i=e.weight/(l*l);c.value.bmi=i,v.success("营养需求计算成功"),g.value="nutritionAnalysis"}else v.error((t==null?void 0:t.msg)||"计算失败，请稍后重试")}catch(t){console.error("计算营养计划失败:",t),(!t.message||!t.message.includes("Validation failed"))&&v.error("计算失败，请稍后重试")}finally{s.value=!1}},w=()=>{if(!e.height||!e.weight)return 0;const t=e.height/100;return e.weight/(t*t)},I=t=>t<18.5?"偏瘦":t<24?"正常":t<28?"超重":t<35?"肥胖":"重度肥胖",f=async()=>{try{await N.value.validate(),s.value=!0;const t=JSON.parse(localStorage.getItem("system-user")||"{}");if(!t.id){v.error("用户未登录，请重新登录"),s.value=!1;return}const l={...e,height:Number(e.height),weight:Number(e.weight),age:Number(e.age)};console.log("保存的健康数据类型:",{height:typeof l.height,weight:typeof l.weight,age:typeof l.age,heightValue:l.height,weightValue:l.weight,ageValue:l.age});const i=await b.put(`/nutritionAnalysis/updateHealthData/${t.id}`,l);if(i&&i.code==="200"){if(e.height&&e.weight){const u=w(),r=I(u);o.value=!0,v.success(`健康数据保存成功！您的BMI为${u.toFixed(1)} (${r})`)}else v.success("健康数据保存成功");e.height=Number(e.height),e.weight=Number(e.weight),e.age=Number(e.age);try{const u=await b.post("/nutritionAnalysis/nutritionPlan",l);if(u.code==="200"){c.value=u.data,console.log("营养计划重新计算成功");const r=await b.get(`/user/selectById/${t.id}`);r.code==="200"&&r.data&&(console.log("更新后的健康数据:",r.data),r.data.height&&(e.height=Number(r.data.height)),r.data.weight&&(e.weight=Number(r.data.weight)),r.data.age&&(e.age=Number(r.data.age)),r.data.gender&&(e.gender=r.data.gender),r.data.activityLevel&&(e.activityLevel=r.data.activityLevel),r.data.goal&&(e.goal=r.data.goal)),g.value==="recipeRecommendation"?await getRecipeRecommendations():showRecommendations.value=!0}}catch(u){console.error("重新计算营养计划失败:",u)}}else v.error((i==null?void 0:i.msg)||"保存失败，请稍后重试")}catch(t){console.error("保存健康数据失败:",t),(!t.message||!t.message.includes("Validation failed"))&&v.error("保存失败，请稍后重试")}finally{s.value=!1}},F=async(t=!1)=>{try{s.value=!0;const l=JSON.parse(localStorage.getItem("system-user")||"{}");if(!l.id){console.error("用户未登录"),s.value=!1;return}const i=await b.get(`/user/selectById/${l.id}`);if(i.code==="200"&&i.data){const u=i.data;if((t||e.height===null&&u.height)&&(e.height=u.height),(t||e.weight===null&&u.weight)&&(e.weight=u.weight),(t||e.age===null&&u.age)&&(e.age=u.age),u.gender&&(e.gender=u.gender),u.activityLevel&&(e.activityLevel=u.activityLevel),u.goal&&(e.goal=u.goal),typeof e.height=="number"&&e.height>0&&typeof e.weight=="number"&&e.weight>0&&typeof e.age=="number"&&e.age>0)try{const r=await b.post("/nutritionAnalysis/nutritionPlan",e);r.code==="200"&&(c.value=r.data,console.log("营养计划计算成功:",c.value))}catch(r){console.error("自动计算营养计划失败:",r)}}}catch(l){console.error("加载健康数据失败:",l)}finally{s.value=!1}},B=()=>{if(!c.value||!c.value.nutrients)return[];const{nutrients:t}=c.value;return[{name:"蛋白质",value:t.protein,unit:"g"},{name:"碳水化合物",value:t.carbohydrate,unit:"g"},{name:"脂肪",value:t.fat,unit:"g"}]},M=()=>{if(!c.value)return"";const{goal:t}=e;switch(t){case"减重":return"减重期间建议适当增加蛋白质摄入，控制碳水化合物摄入，选择低脂食物，保证足够的膳食纤维和水分摄入。";case"增肌":return"增肌期间建议增加优质蛋白质摄入，适量增加碳水化合物，保证足够的热量盈余，结合适当的力量训练。";case"维持健康":default:return"维持健康期间建议保持均衡的饮食结构，摄入足够的各类营养素，合理分配三餐比例。"}};return x(()=>{F()}),{activeTab:g,loading:s,healthDataFormRef:N,healthDataForm:e,healthDataRules:R,showBMI:o,nutritionPlan:c,handleTabClick:_,calculateNutritionPlan:p,saveHealthData:f,getNutrientData:B,getNutritionAdvice:M,getBMICategory:I,calculateBMI:w}}},m=g=>(U("data-v-22a17f54"),g=g(),O(),g),ie={class:"recommendation-container"},ne=m(()=>d("h1",null,"营养需求分析",-1)),se={class:"bmi-display-card"},re=m(()=>d("h3",null,"BMI 计算结果",-1)),de={key:0,class:"bmi-result"},ue={class:"bmi-value"},ce={class:"bmi-category"},he={key:1,class:"bmi-empty"},ge=m(()=>d("p",null,"请输入身高和体重以计算BMI",-1)),me=[ge],_e=m(()=>d("div",{class:"bmi-hint"},[d("p",null,'点击"保存健康数据"后将显示您的BMI信息')],-1)),fe={key:0,class:"nutrition-analysis"},ve=m(()=>d("h3",null,"您的营养需求分析",-1)),pe={class:"nutrition-stats"},ye={class:"nutrition-stat-item"},be=m(()=>d("div",{class:"nutrition-stat-label"},"基础代谢率(BMR)",-1)),we={class:"nutrition-stat-value"},De={class:"nutrition-stat-item"},Ve=m(()=>d("div",{class:"nutrition-stat-label"},"总能量消耗(TDEE)",-1)),Ee={class:"nutrition-stat-value"},Ne={class:"nutrition-stat-item"},Ie=m(()=>d("div",{class:"nutrition-stat-label"},"推荐卡路里",-1)),Fe={class:"nutrition-stat-value"},Be={class:"nutrition-details"},Me=m(()=>d("h4",null,"每日营养素需求",-1)),Ce={class:"nutrition-advice"},Re=m(()=>d("h4",null,"营养建议",-1)),Te={key:1,class:"empty-state"};function Ae(g,s,N,o,e,R){const c=J,_=G,p=j,w=z,I=X,f=K,F=Q,B=W,M=Y,t=Z,l=$,i=ee,u=te,r=ae,T=q,A=le,L=H;return V(),E("div",ie,[ne,a(T,{modelValue:o.activeTab,"onUpdate:modelValue":s[6]||(s[6]=h=>o.activeTab=h),type:"border-card",onTabClick:o.handleTabClick},{default:n(()=>[a(l,{label:"健康数据",name:"healthData"},{default:n(()=>[a(B,{gutter:20},{default:n(()=>[a(p,{span:16},{default:n(()=>[a(t,{ref:"healthDataFormRef",model:o.healthDataForm,rules:o.healthDataRules,"label-width":"100px",class:"health-data-form"},{default:n(()=>[a(B,{gutter:20},{default:n(()=>[a(p,{span:12},{default:n(()=>[a(_,{label:"身高(cm)",prop:"height"},{default:n(()=>[a(c,{modelValue:o.healthDataForm.height,"onUpdate:modelValue":s[0]||(s[0]=h=>o.healthDataForm.height=h),type:"number",placeholder:"请输入身高"},null,8,["modelValue"])]),_:1}),a(_,{label:"体重(kg)",prop:"weight"},{default:n(()=>[a(c,{modelValue:o.healthDataForm.weight,"onUpdate:modelValue":s[1]||(s[1]=h=>o.healthDataForm.weight=h),type:"number",placeholder:"请输入体重"},null,8,["modelValue"])]),_:1}),a(_,{label:"年龄",prop:"age"},{default:n(()=>[a(c,{modelValue:o.healthDataForm.age,"onUpdate:modelValue":s[2]||(s[2]=h=>o.healthDataForm.age=h),type:"number",placeholder:"请输入年龄"},null,8,["modelValue"])]),_:1})]),_:1}),a(p,{span:12},{default:n(()=>[a(_,{label:"性别",prop:"gender"},{default:n(()=>[a(I,{modelValue:o.healthDataForm.gender,"onUpdate:modelValue":s[3]||(s[3]=h=>o.healthDataForm.gender=h)},{default:n(()=>[a(w,{label:"男"},{default:n(()=>[C("男")]),_:1}),a(w,{label:"女"},{default:n(()=>[C("女")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(_,{label:"活动水平",prop:"activityLevel"},{default:n(()=>[a(F,{modelValue:o.healthDataForm.activityLevel,"onUpdate:modelValue":s[4]||(s[4]=h=>o.healthDataForm.activityLevel=h),placeholder:"请选择活动水平"},{default:n(()=>[a(f,{label:"久坐",value:"久坐"}),a(f,{label:"轻度",value:"轻度"}),a(f,{label:"中度",value:"中度"}),a(f,{label:"重度",value:"重度"})]),_:1},8,["modelValue"])]),_:1}),a(_,{label:"健康目标",prop:"goal"},{default:n(()=>[a(F,{modelValue:o.healthDataForm.goal,"onUpdate:modelValue":s[5]||(s[5]=h=>o.healthDataForm.goal=h),placeholder:"请选择健康目标"},{default:n(()=>[a(f,{label:"维持健康",value:"维持健康"}),a(f,{label:"减重",value:"减重"}),a(f,{label:"增肌",value:"增肌"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(_,null,{default:n(()=>[a(M,{type:"primary",onClick:o.calculateNutritionPlan},{default:n(()=>[C("计算营养需求")]),_:1},8,["onClick"]),a(M,{onClick:o.saveHealthData},{default:n(()=>[C("保存健康数据")]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])]),_:1}),a(p,{span:8},{default:n(()=>[d("div",se,[re,o.showBMI&&o.healthDataForm.height&&o.healthDataForm.weight?(V(),E("div",de,[d("div",ue,y(o.calculateBMI().toFixed(1)),1),d("div",ce,y(o.getBMICategory(o.calculateBMI())),1)])):(V(),E("div",he,me)),_e])]),_:1})]),_:1})]),_:1}),a(l,{label:"营养分析",name:"nutritionAnalysis"},{default:n(()=>[o.nutritionPlan?(V(),E("div",fe,[ve,d("div",pe,[d("div",ye,[be,d("div",we,y(o.nutritionPlan.bmr)+" 卡路里",1)]),d("div",De,[Ve,d("div",Ee,y(o.nutritionPlan.tdee)+" 卡路里",1)]),d("div",Ne,[Ie,d("div",Fe,y(o.nutritionPlan.recommendedCalories)+" 卡路里",1)])]),d("div",Be,[Me,a(u,{data:o.getNutrientData(),style:{width:"100%"}},{default:n(()=>[a(i,{prop:"name",label:"营养素"}),a(i,{prop:"value",label:"需求"}),a(i,{prop:"unit",label:"单位"})]),_:1},8,["data"])]),d("div",Ce,[Re,d("p",null,y(o.getNutritionAdvice()),1)])])):(V(),E("div",Te,[a(r,{description:"请先填写健康数据并计算营养需求"})]))]),_:1})]),_:1},8,["modelValue","onTabClick"]),S(a(A,{lock:"",text:"处理中..."},null,512),[[L,o.loading]])])}const Je=P(oe,[["render",Ae],["__scopeId","data-v-22a17f54"]]);export{Je as default};
