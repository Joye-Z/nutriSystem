import{_ as Q,R as v,r as W,A as X,b as Y,o as d,c as m,e as o,w as r,U as Z,E as i,G as $,a4 as ee,W as ae,q as f,d as s,t as u,K as S,L as U,h as G,i as j,p as te,j as le,x as oe,y as ne,M as se,a5 as re,a6 as ie,N as ce,O as de,J as ue,z as me,n as pe,a7 as _e,H as he,C as ge,a8 as ve,a9 as fe,aa as ye,ab as we,k as be,Q as ke,ac as De}from"./index-0b508a82.js";/* empty css                *//* empty css               *//* empty css             *//* empty css             *//* empty css                    *//* empty css                *//* empty css               *//* empty css              *//* empty css            */import{r as y}from"./request-617fd929.js";const Ce={name:"Recommendation",setup(){const g=v("healthData"),n=v(!1),x=v(),e=W({height:null,weight:null,age:null,gender:"男",activityLevel:"中度",goal:"维持健康"}),z={height:[{required:!0,message:"请输入身高",trigger:"blur"},{type:"number",message:"身高应在100-250cm之间",trigger:"change",validator:(a,t,l)=>{t==null||t===""?l():t<100||t>250?l(new Error("身高应在100-250cm之间")):l()}}],weight:[{required:!0,message:"请输入体重",trigger:"blur"},{type:"number",message:"体重应在30-300kg之间",trigger:"change",validator:(a,t,l)=>{t==null||t===""?l():t<30||t>300?l(new Error("体重应在30-300kg之间")):l()}}],age:[{required:!0,message:"请输入年龄",trigger:"blur"},{type:"number",message:"年龄应在1-150之间",trigger:"change",validator:(a,t,l)=>{t==null||t===""?l():t<1||t>150?l(new Error("年龄应在1-150之间")):l()}}],gender:[{required:!1,message:"请选择性别",trigger:"change"}],activityLevel:[{required:!1,message:"请选择活动水平",trigger:"change"}],goal:[{required:!1,message:"请选择健康目标",trigger:"change"}]},c=v(null),k=v(!1),w=[{label:"早餐",value:"早餐"},{label:"午餐",value:"午餐"},{label:"晚餐",value:"晚餐"},{label:"加餐",value:"加餐"}],P=v("午餐"),F=v(3),M=v([]),p=v(!1),D=v(!1),N=v(null),h=async a=>{if(a.paneName==="nutritionAnalysis"){if(!c.value&&(await b(),e.height&&e.weight&&e.age&&!c.value))try{n.value=!0;const t=await y.post("/recommendation/nutritionPlan",e);t.code==="200"&&(c.value=t.data)}catch(t){console.error("自动计算营养计划失败:",t)}finally{n.value=!1}}else if(a.paneName==="recipeRecommendation")if(e.height&&e.weight&&e.age)try{if(n.value=!0,!c.value){const t=await y.post("/recommendation/nutritionPlan",e);t.code==="200"&&(c.value=t.data)}c.value&&(k.value=!0)}catch(t){console.error("自动计算营养计划失败:",t)}finally{n.value=!1}else try{await b(),e.height&&e.weight&&e.age&&await h(a)}catch(t){console.error("加载用户健康数据失败:",t)}else if(a.paneName==="mealPlan")if(e.height&&e.weight&&e.age)try{if(n.value=!0,!c.value){const t=await y.post("/recommendation/nutritionPlan",e);t.code==="200"&&(c.value=t.data)}c.value&&(p.value=!0)}catch(t){console.error("自动计算营养计划失败:",t)}finally{n.value=!1}else try{await b(),e.height&&e.weight&&e.age&&await h(a)}catch(t){console.error("加载用户健康数据失败:",t)}},B=async()=>{try{await x.value.validate(),n.value=!0;const a=await y.post("/recommendation/nutritionPlan",e);a&&a.code==="200"?(c.value=a.data,i.success("营养需求计算成功"),g.value="nutritionAnalysis"):i.error((a==null?void 0:a.msg)||"计算失败，请稍后重试")}catch(a){console.error("计算营养计划失败:",a),(!a.message||!a.message.includes("Validation failed"))&&i.error("计算失败，请稍后重试")}finally{n.value=!1}},V=async()=>{try{await x.value.validate(),n.value=!0;const a=JSON.parse(localStorage.getItem("system-user")||"{}");if(!a.id){i.error("用户未登录，请重新登录"),n.value=!1;return}const t=await y.put(`/recommendation/updateHealthData/${a.id}`,e);t&&t.code==="200"?i.success("健康数据保存成功"):i.error((t==null?void 0:t.msg)||"保存失败，请稍后重试")}catch(a){console.error("保存健康数据失败:",a),(!a.message||!a.message.includes("Validation failed"))&&i.error("保存失败，请稍后重试")}finally{n.value=!1}},b=async()=>{try{n.value=!0;const a=JSON.parse(localStorage.getItem("system-user")||"{}");if(!a.id){console.error("用户未登录"),n.value=!1;return}const t=await y.get(`/user/selectById/${a.id}`);if(t.code==="200"&&t.data){const l=t.data;if(e.height=l.height||"",e.weight=l.weight||"",e.age=l.age||"",e.gender=l.gender||"",e.activityLevel=l.activityLevel||"",e.goal=l.goal||"",e.height&&e.weight&&e.age)try{const _=await y.post("/recommendation/nutritionPlan",e);_.code==="200"&&(c.value=_.data,console.log("营养计划计算成功:",c.value))}catch(_){console.error("自动计算营养计划失败:",_)}}}catch(a){console.error("加载健康数据失败:",a)}finally{n.value=!1}},L=()=>{if(!c.value||!c.value.nutrients)return[];const{nutrients:a}=c.value;return[{name:"蛋白质",value:a.protein,unit:"g"},{name:"碳水化合物",value:a.carbohydrate,unit:"g"},{name:"脂肪",value:a.fat,unit:"g"}]},R=()=>{if(!c.value)return"";const{goal:a}=e;switch(a){case"减重":return"减重期间建议适当增加蛋白质摄入，控制碳水化合物摄入，选择低脂食物，保证足够的膳食纤维和水分摄入。";case"增肌":return"增肌期间建议增加优质蛋白质摄入，适量增加碳水化合物，保证足够的热量盈余，结合适当的力量训练。";case"维持健康":default:return"维持健康期间建议保持均衡的饮食结构，摄入足够的各类营养素，合理分配三餐比例。"}},q=a=>{P.value=a,M.value=[]},T=async()=>{if(!JSON.parse(localStorage.getItem("system-user")||"{}").id)return i.error("用户未登录，请重新登录"),!1;if(!c.value)if(e.height&&e.weight&&e.age)try{n.value=!0;const t=await y.post("/recommendation/nutritionPlan",e);return t.code==="200"?(c.value=t.data,n.value=!1,g.value==="recipeRecommendation"?k.value=!0:g.value==="mealPlan"&&(p.value=!0),!0):(n.value=!1,console.warn("营养计划计算失败:",t.msg),!1)}catch(t){return n.value=!1,console.error("自动计算营养计划失败:",t),!1}else{try{if(await b(),e.height&&e.weight&&e.age)return await T()}catch(t){console.error("加载用户健康数据失败:",t)}return i.warning("用户健康数据不完整，请补充以下信息：体重、身高、年龄"),!1}return g.value==="recipeRecommendation"?k.value=!0:g.value==="mealPlan"&&(p.value=!0),!0},I=async()=>{try{if(n.value=!0,!await T()){i.warning("用户健康数据不完整，请补充以下信息：体重、身高、年龄"),n.value=!1;return}const l={userId:JSON.parse(localStorage.getItem("system-user")||"{}").id,mealType:P.value,count:F.value},_=await y.get("/recommendation/recipes",{params:l});_.code==="200"?M.value=_.data:i.error(_.msg||"获取推荐失败")}catch(a){console.error("获取食谱推荐失败:",a),a.response&&a.response.data&&a.response.data.msg&&a.response.data.msg.includes("用户健康数据不完整")?i.warning("用户健康数据不完整，请补充以下信息：体重、身高、年龄"):i.error("获取失败，请稍后重试")}finally{n.value=!1}},O=a=>{i.info(`查看食谱ID: ${a} 的详情`)},A=async()=>{try{if(D.value=!0,!await T()){i.warning("用户健康数据不完整，请补充以下信息：体重、身高、年龄"),D.value=!1;return}const t=JSON.parse(localStorage.getItem("system-user")||"{}"),l=await y.get(`/recommendation/mealPlan/${t.id}`);l.code==="200"?(N.value=l.data,i.success("膳食计划生成成功")):i.error(l.msg||"生成失败")}catch(a){console.error("生成膳食计划失败:",a),a.response&&a.response.data&&a.response.data.msg&&a.response.data.msg.includes("用户健康数据不完整")?i.warning("用户健康数据不完整，请补充以下信息：体重、身高、年龄"):i.error("生成失败，请稍后重试")}finally{D.value=!1}},H=()=>{$.confirm("确定要保存此膳食计划吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(async()=>{try{n.value=!0;const a=await y.post("/recommendation/save-meal-plan",N.value);a.code==="200"?i.success("保存成功"):i.error(a.msg||"保存失败")}catch(a){console.error("保存膳食计划失败:",a),i.error("保存失败，请稍后重试")}finally{n.value=!1}})},J=()=>{i.info("导出功能开发中")};return X(()=>{b()}),{activeTab:g,loading:n,healthDataFormRef:x,healthDataForm:e,healthDataRules:z,nutritionPlan:c,showRecommendations:k,mealTypes:w,selectedMealType:P,recommendationCount:F,recommendedRecipes:M,showMealPlan:p,generatingMealPlan:D,mealPlanData:N,handleTabClick:h,calculateNutritionPlan:B,saveHealthData:V,getNutrientData:L,getNutritionAdvice:R,selectMealType:q,getRecipeRecommendations:I,viewRecipeDetail:O,generateMealPlan:A,saveMealPlan:H,exportMealPlan:J}}},C=g=>(te("data-v-c3c875ce"),g=g(),le(),g),Re={class:"recommendation-container"},Pe=C(()=>s("h1",null,"个性化膳食推荐",-1)),Ve={key:0,class:"nutrition-analysis"},Ee=C(()=>s("h3",null,"您的营养需求分析",-1)),Fe={class:"nutrition-stats"},Me={class:"nutrition-stat-item"},Ne=C(()=>s("div",{class:"nutrition-stat-label"},"基础代谢率(BMR)",-1)),Te={class:"nutrition-stat-value"},xe={class:"nutrition-stat-item"},Ie=C(()=>s("div",{class:"nutrition-stat-label"},"总能量消耗(TDEE)",-1)),Se={class:"nutrition-stat-value"},Ue={class:"nutrition-stat-item"},Be=C(()=>s("div",{class:"nutrition-stat-label"},"推荐卡路里",-1)),Le={class:"nutrition-stat-value"},qe={class:"nutrition-details"},Oe=C(()=>s("h4",null,"每日营养素需求",-1)),Ae={class:"nutrition-advice"},He=C(()=>s("h4",null,"营养建议",-1)),Je={key:1,class:"empty-state"},Ge={key:0,class:"recipe-recommendation"},ze={class:"meal-type-selector"},je={class:"recommendation-controls"},Ke={key:0,class:"recipe-list"},Qe={class:"recipe-card-header"},We={class:"recipe-card-body"},Xe={class:"recipe-nutrition"},Ye={class:"recipe-description"},Ze={key:1,class:"empty-state"},$e={key:1,class:"empty-state"},ea={key:0,class:"meal-plan"},aa={key:0,class:"meal-plan-data"},ta=C(()=>s("h3",null,"您的一日膳食计划",-1)),la={class:"meal-recipes"},oa={class:"meal-recipe-header"},na={class:"meal-recipe-nutrition"},sa={class:"meal-plan-actions"},ra={key:1,class:"empty-state"},ia={key:1,class:"empty-state"};function ca(g,n,x,e,z,c){const k=oe,w=ne,P=se,F=re,M=ie,p=ce,D=de,N=ue,h=me,B=pe,V=_e,b=he,L=ge,R=ve,q=fe,T=ye,I=we,O=Y("Refresh"),A=be,H=ke,J=ee,a=De,t=ae;return d(),m("div",Re,[Pe,o(J,{modelValue:e.activeTab,"onUpdate:modelValue":n[7]||(n[7]=l=>e.activeTab=l),type:"border-card",onTabClick:e.handleTabClick},{default:r(()=>[o(V,{label:"健康数据",name:"healthData"},{default:r(()=>[o(B,{ref:"healthDataFormRef",model:e.healthDataForm,rules:e.healthDataRules,"label-width":"100px",class:"health-data-form"},{default:r(()=>[o(N,{gutter:20},{default:r(()=>[o(P,{span:12},{default:r(()=>[o(w,{label:"身高(cm)",prop:"height"},{default:r(()=>[o(k,{modelValue:e.healthDataForm.height,"onUpdate:modelValue":n[0]||(n[0]=l=>e.healthDataForm.height=l),type:"number",placeholder:"请输入身高"},null,8,["modelValue"])]),_:1}),o(w,{label:"体重(kg)",prop:"weight"},{default:r(()=>[o(k,{modelValue:e.healthDataForm.weight,"onUpdate:modelValue":n[1]||(n[1]=l=>e.healthDataForm.weight=l),type:"number",placeholder:"请输入体重"},null,8,["modelValue"])]),_:1}),o(w,{label:"年龄",prop:"age"},{default:r(()=>[o(k,{modelValue:e.healthDataForm.age,"onUpdate:modelValue":n[2]||(n[2]=l=>e.healthDataForm.age=l),type:"number",placeholder:"请输入年龄"},null,8,["modelValue"])]),_:1})]),_:1}),o(P,{span:12},{default:r(()=>[o(w,{label:"性别",prop:"gender"},{default:r(()=>[o(M,{modelValue:e.healthDataForm.gender,"onUpdate:modelValue":n[3]||(n[3]=l=>e.healthDataForm.gender=l)},{default:r(()=>[o(F,{label:"男"},{default:r(()=>[f("男")]),_:1}),o(F,{label:"女"},{default:r(()=>[f("女")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(w,{label:"活动水平",prop:"activityLevel"},{default:r(()=>[o(D,{modelValue:e.healthDataForm.activityLevel,"onUpdate:modelValue":n[4]||(n[4]=l=>e.healthDataForm.activityLevel=l),placeholder:"请选择活动水平"},{default:r(()=>[o(p,{label:"久坐",value:"久坐"}),o(p,{label:"轻度",value:"轻度"}),o(p,{label:"中度",value:"中度"}),o(p,{label:"重度",value:"重度"})]),_:1},8,["modelValue"])]),_:1}),o(w,{label:"健康目标",prop:"goal"},{default:r(()=>[o(D,{modelValue:e.healthDataForm.goal,"onUpdate:modelValue":n[5]||(n[5]=l=>e.healthDataForm.goal=l),placeholder:"请选择健康目标"},{default:r(()=>[o(p,{label:"维持健康",value:"维持健康"}),o(p,{label:"减重",value:"减重"}),o(p,{label:"增肌",value:"增肌"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(w,null,{default:r(()=>[o(h,{type:"primary",onClick:e.calculateNutritionPlan},{default:r(()=>[f("计算营养需求")]),_:1},8,["onClick"]),o(h,{onClick:e.saveHealthData},{default:r(()=>[f("保存健康数据")]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])]),_:1}),o(V,{label:"营养分析",name:"nutritionAnalysis"},{default:r(()=>[e.nutritionPlan?(d(),m("div",Ve,[Ee,s("div",Fe,[s("div",Me,[Ne,s("div",Te,u(e.nutritionPlan.bmr)+" 卡路里",1)]),s("div",xe,[Ie,s("div",Se,u(e.nutritionPlan.tdee)+" 卡路里",1)]),s("div",Ue,[Be,s("div",Le,u(e.nutritionPlan.recommendedCalories)+" 卡路里",1)])]),s("div",qe,[Oe,o(L,{data:e.getNutrientData(),style:{width:"100%"}},{default:r(()=>[o(b,{prop:"name",label:"营养素"}),o(b,{prop:"value",label:"需求"}),o(b,{prop:"unit",label:"单位"})]),_:1},8,["data"])]),s("div",Ae,[He,s("p",null,u(e.getNutritionAdvice()),1)])])):(d(),m("div",Je,[o(R,{description:"请先填写健康数据并计算营养需求"})]))]),_:1}),o(V,{label:"食谱推荐",name:"recipeRecommendation"},{default:r(()=>[e.showRecommendations?(d(),m("div",Ge,[s("div",ze,[o(q,null,{default:r(()=>[(d(!0),m(S,null,U(e.mealTypes,l=>(d(),G(h,{key:l.value,type:e.selectedMealType===l.value?"primary":"default",onClick:_=>e.selectMealType(l.value)},{default:r(()=>[f(u(l.label),1)]),_:2},1032,["type","onClick"]))),128))]),_:1}),s("div",je,[o(D,{modelValue:e.recommendationCount,"onUpdate:modelValue":n[6]||(n[6]=l=>e.recommendationCount=l),placeholder:"推荐数量"},{default:r(()=>[o(p,{value:3,label:"3个"}),o(p,{value:5,label:"5个"}),o(p,{value:10,label:"10个"})]),_:1},8,["modelValue"]),o(h,{type:"success",onClick:e.getRecipeRecommendations},{default:r(()=>[f("获取推荐")]),_:1},8,["onClick"])])]),e.recommendedRecipes.length>0?(d(),m("div",Ke,[(d(!0),m(S,null,U(e.recommendedRecipes,l=>(d(),G(I,{key:l.recipe.id,class:"recipe-card"},{header:r(()=>[s("div",Qe,[s("span",null,u(l.recipe.name),1),o(T,{modelValue:l.score,"onUpdate:modelValue":_=>l.score=_,disabled:"","show-score":"","score-template":"{{ item.score }}"},null,8,["modelValue","onUpdate:modelValue"])])]),default:r(()=>[s("div",We,[s("div",Xe,[s("span",null,"卡路里: "+u(l.recipe.calories),1),s("span",null,"蛋白质: "+u(l.recipe.protein)+"g",1),s("span",null,"碳水: "+u(l.recipe.carbohydrate)+"g",1),s("span",null,"脂肪: "+u(l.recipe.fat)+"g",1)]),s("div",Ye,u(l.recipe.description||"暂无描述"),1),o(h,{type:"primary",size:"small",onClick:_=>e.viewRecipeDetail(l.recipe.id)},{default:r(()=>[f("查看详情")]),_:2},1032,["onClick"])])]),_:2},1024))),128))])):e.showRecommendations?(d(),m("div",Ze,[o(R,{description:"暂无推荐食谱"})])):j("",!0)])):(d(),m("div",$e,[o(R,{description:"请先完成健康数据录入"})]))]),_:1}),o(V,{label:"膳食计划",name:"mealPlan"},{default:r(()=>[e.showMealPlan?(d(),m("div",ea,[o(h,{type:"success",onClick:e.generateMealPlan,loading:e.generatingMealPlan},{default:r(()=>[o(A,null,{default:r(()=>[o(O)]),_:1}),f(" 生成膳食计划 ")]),_:1},8,["onClick","loading"]),e.mealPlanData?(d(),m("div",aa,[ta,(d(!0),m(S,null,U(e.mealPlanData,(l,_)=>(d(),m("div",{key:_,class:"meal-type-section"},[s("h4",null,u(_),1),s("div",la,[(d(!0),m(S,null,U(l,(E,K)=>(d(),G(I,{key:K,class:"meal-recipe-card"},{default:r(()=>[s("div",oa,[s("span",null,u(E.recipe.name),1),o(H,{size:"small",type:"success"},{default:r(()=>[f("推荐指数: "+u(E.score.toFixed(1)),1)]),_:2},1024)]),s("div",na,[s("span",null,"卡路里: "+u(E.recipe.calories),1),s("span",null,"蛋白质: "+u(E.recipe.protein)+"g",1),s("span",null,"碳水: "+u(E.recipe.carbohydrate)+"g",1),s("span",null,"脂肪: "+u(E.recipe.fat)+"g",1)])]),_:2},1024))),128))])]))),128)),s("div",sa,[o(h,{type:"primary",onClick:e.saveMealPlan},{default:r(()=>[f("保存膳食计划")]),_:1},8,["onClick"]),o(h,{onClick:e.exportMealPlan},{default:r(()=>[f("导出膳食计划")]),_:1},8,["onClick"])])])):e.showMealPlan?(d(),m("div",ra,[o(R,{description:"请点击生成膳食计划"})])):j("",!0)])):(d(),m("div",ia,[o(R,{description:"请先完成健康数据录入"})]))]),_:1})]),_:1},8,["modelValue","onTabClick"]),Z(o(a,{lock:"",text:"处理中..."},null,512),[[t,e.loading]])])}const ba=Q(Ce,[["render",ca],["__scopeId","data-v-c3c875ce"]]);export{ba as default};
