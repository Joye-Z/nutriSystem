import{_ as Y,r as Z,A as ee,o as g,c as y,d as n,e,w as t,i as R,z as le,J as oe,C as te,D as ae,F as se,q as r,t as c,h as ne,u as ie,K as de,L as D,M as z,G as re,E as b,x as pe,N as ue,O as ce,P as me,I as fe,H as ge,k as _e,v as ye,y as be,n as Ve,Q as he,R as xe,p as ve,j as we}from"./index-07fe75f3.js";/* empty css               *//* empty css                   *//* empty css                    *//* empty css              *//* empty css                 *//* empty css             *//* empty css               *//* empty css                *//* empty css                     *//* empty css            */import{r as E}from"./request-c1aee9f6.js";const V=w=>(ve("data-v-c20b458d"),w=w(),we(),w),ke={class:"card",style:{"margin-bottom":"5px"}},Re={class:"card",style:{"margin-bottom":"5px"}},Ee={key:0,style:{"margin-bottom":"10px"}},Ue={class:"card"},Ie={style:{display:"flex","align-items":"center",gap:"20px"}},Ne={key:0,style:{"flex-shrink":"0",position:"relative"}},Se={style:{flex:"1"}},Ce=V(()=>n("div",{style:{"margin-top":"10px",color:"#999","font-size":"12px"}}," 支持 JPG、PNG 格式，文件大小不超过 2MB ",-1)),De={class:"dialog-footer"},ze={key:0,style:{padding:"20px"}},Te={style:{"margin-top":"0"}},Oe={style:{color:"#666","line-height":"1.6"}},Pe={style:{"text-align":"center"}},Je={style:{"font-size":"24px",color:"#409EFF","font-weight":"bold"}},Ae=V(()=>n("div",{style:{color:"#999"}},"分钟",-1)),Fe={style:{"text-align":"center"}},Be={style:{"font-size":"24px",color:"#67C23A","font-weight":"bold"}},Le=V(()=>n("div",{style:{color:"#999"}},"卡路里",-1)),Me={style:{"text-align":"center"}},$e={style:{"font-size":"24px",color:"#E6A23C","font-weight":"bold"}},je=V(()=>n("div",{style:{color:"#999"}},"蛋白质(g)",-1)),qe={style:{"text-align":"center"}},Ge={style:{"font-size":"24px",color:"#F56C6C","font-weight":"bold"}},He=V(()=>n("div",{style:{color:"#999"}},"难度",-1)),Ke=V(()=>n("h3",null,"食材清单",-1)),Qe={style:{background:"#f8f9fa",padding:"15px","border-radius":"6px"}},We={style:{"margin-left":"10px"}},Xe=V(()=>n("h3",null,"烹饪步骤",-1)),Ye={style:{background:"#f8f9fa",padding:"15px","border-radius":"6px"}},Ze={style:{display:"flex","align-items":"flex-start"}},el={style:{background:"#409EFF",color:"white",width:"24px",height:"24px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","margin-right":"10px","flex-shrink":"0"}},ll={style:{"line-height":"1.6"}},ol={class:"dialog-footer"},v="/images/default-image.png",tl={__name:"Recipe",setup(w){const U=s=>{if(!s)return"";let o=s;const i=s.indexOf("?");return i>0&&(o=s.substring(0,i)),o},T="http://:9090/files/upload",l=Z({pageNum:1,pageSize:10,total:0,formVisible:!1,detailVisible:!1,currentRecipe:null,selectedRowId:null,form:{},tableData:[],name:null,category:null,difficulty:null,userRole:JSON.parse(localStorage.getItem("system-user")||"{}").role||"USER"}),I=(s,o=null)=>{console.error("图片加载失败:",s);const i=s.target;o&&o.image&&console.warn(`食谱ID: ${o.id}, 图片URL: ${o.image} 加载失败`),i.src!==v&&(console.log("使用默认图片"),i.src=v)};ee(()=>{console.log("组件挂载完成，自动调用load函数"),h()});const O=()=>{l.form={},l.formVisible=!0},P=(s,o)=>{console.log("=== 开始处理行点击事件 ==="),console.log("点击行数据:",JSON.stringify(s,null,2)),console.log("事件对象存在:",!!o),l.selectedRowId=s.id,console.log("已设置选中行ID:",s.id),l.detailVisible=!1,console.log("弹窗已关闭，准备更新数据"),setTimeout(()=>{console.log("第一个定时器执行，准备重置currentRecipe"),l.currentRecipe=null,setTimeout(()=>{console.log("第二个定时器执行，准备赋值新数据");const i=JSON.parse(JSON.stringify(s));console.log("新食谱数据:",JSON.stringify(i,null,2)),l.currentRecipe=i,console.log("currentRecipe已更新"),l.detailVisible=!0,console.log("弹窗已打开，显示食谱:",s.name),console.log("=== 行点击事件处理完成 ===")},100)},50)},J=({row:s})=>s.id===l.selectedRowId?"selected-row":"",A=(s,o)=>{o&&o.stopPropagation(),l.form=JSON.parse(JSON.stringify(s)),l.formVisible=!0},F=()=>{E.post("/recipe/add",l.form).then(s=>{s.code==="200"?(l.formVisible=!1,setTimeout(()=>{l.pageNum=1,h()},100),b.success("操作成功")):b.error(s.msg)})},B=()=>{E.put("/recipe/update",l.form).then(s=>{s.code==="200"?(l.formVisible=!1,setTimeout(()=>{h()},100),b.success("操作成功")):b.error(s.msg)})},L=()=>{l.form.id?B():F()},M=(s,o)=>{o&&o.stopPropagation(),re.confirm("删除后数据无法恢复，您确定删除吗?","删除确认",{type:"warning"}).then(i=>{E.delete("/recipe/delete/"+s).then(d=>{d.code==="200"?(setTimeout(()=>{l.tableData.length===1&&l.pageNum>1&&l.pageNum--,h()},100),b.success("操作成功")):b.error(d.msg)})}).catch(i=>{})},$=()=>{l.form.image=null},j=()=>{l.name=null,l.category=null,l.difficulty=null,h()},q=s=>{console.log("上传响应:",s);const o=s.data;console.log("使用完整OSS URL:",o),l.form.image=o;const i=new Image;i.onload=()=>console.log("图片URL有效，能够正常加载"),i.onerror=()=>console.error("图片URL无效，无法加载图片"),i.src=o,b.success("上传成功")},h=()=>{console.log("开始加载食谱数据");const s={pageNum:l.pageNum,pageSize:l.pageSize,name:l.name,category:l.category,difficulty:l.difficulty};console.log("发送API请求获取食谱数据，参数:",s),E.get("/recipe/selectPage",{params:s}).then(o=>{console.log("API响应完整内容:",JSON.stringify(o,null,2)),o.code==="200"&&o.data?(console.log("响应数据类型:",typeof o.data),console.log("响应数据属性:",Object.keys(o.data)),l.tableData=o.data.list||[],l.total=o.data.total||0,console.log("表格数据已设置，数量:",l.tableData.length),l.tableData.length>0?(console.log("获取到的前5条食谱数据示例:"),l.tableData.slice(0,5).forEach(i=>{console.log(`食谱ID: ${i.id}, 名称: ${i.name}, 图片URL: ${i.image}`)})):console.log("未获取到任何食谱数据")):(console.error("获取数据失败，响应码:",o.code,"响应消息:",o.msg||o.message),l.tableData=[],l.total=0)}).catch(o=>{console.error("API请求失败，错误详情:",o),o.response&&(console.error("服务器响应状态:",o.response.status),console.error("服务器响应数据:",o.response.data)),l.tableData=[],l.total=0})};return(s,o)=>{const i=pe,d=ue,p=ce,k=me,f=le,x=oe,N=fe,_=ge,G=te,H=ae,K=_e,Q=ye,u=be,W=Ve,C=se,S=he,X=xe;return g(),y("div",null,[n("div",ke,[e(x,{gutter:20},{default:t(()=>[e(d,{span:8},{default:t(()=>[e(i,{modelValue:l.name,"onUpdate:modelValue":o[0]||(o[0]=a=>l.name=a),style:{width:"100%"},placeholder:"请输入食谱名称查询"},null,8,["modelValue"])]),_:1}),e(d,{span:4},{default:t(()=>[e(k,{modelValue:l.category,"onUpdate:modelValue":o[1]||(o[1]=a=>l.category=a),style:{width:"100%"},placeholder:"分类",clearable:""},{default:t(()=>[e(p,{label:"家常菜",value:"家常菜"}),e(p,{label:"健康餐",value:"健康餐"}),e(p,{label:"减脂餐",value:"减脂餐"}),e(p,{label:"素菜",value:"素菜"}),e(p,{label:"荤菜",value:"荤菜"})]),_:1},8,["modelValue"])]),_:1}),e(d,{span:4},{default:t(()=>[e(k,{modelValue:l.difficulty,"onUpdate:modelValue":o[2]||(o[2]=a=>l.difficulty=a),style:{width:"100%"},placeholder:"难度",clearable:""},{default:t(()=>[e(p,{label:"简单",value:"简单"}),e(p,{label:"中等",value:"中等"}),e(p,{label:"困难",value:"困难"})]),_:1},8,["modelValue"])]),_:1}),e(d,{span:4},{default:t(()=>[e(f,{type:"primary",onClick:h},{default:t(()=>[r("查询")]),_:1}),e(f,{type:"info",style:{"margin-left":"10px"},onClick:j},{default:t(()=>[r("重置")]),_:1})]),_:1})]),_:1})]),n("div",Re,[l.userRole==="ADMIN"?(g(),y("div",Ee,[e(f,{type:"primary",onClick:O},{default:t(()=>[r("新增食谱")]),_:1})])):R("",!0),e(G,{data:l.tableData,stripe:"",onRowClick:P,"row-class-name":J},{default:t(()=>[e(_,{label:"食谱图片",width:"100"},{default:t(a=>[e(N,{src:U(a.row.image),style:{width:"60px",height:"60px","border-radius":"6px"},fallback:v,onError:m=>I(m,a.row)},null,8,["src","onError"])]),_:1}),e(_,{label:"食谱名称",prop:"name",width:"200"}),e(_,{label:"描述",prop:"description","show-overflow-tooltip":""}),e(_,{label:"分类",prop:"category",width:"100"}),e(_,{label:"难度",prop:"difficulty",width:"80"}),e(_,{label:"烹饪时间",width:"100"},{default:t(a=>[r(c(a.row.cookingTime)+"分钟 ",1)]),_:1}),e(_,{label:"热量",width:"80"},{default:t(a=>[r(c(a.row.calories)+"卡 ",1)]),_:1}),l.userRole==="ADMIN"?(g(),ne(_,{key:0,label:"操作",align:"center",width:"150"},{default:t(a=>[e(f,{type:"warning",size:"small",onClick:m=>A(a.row,m)},{default:t(()=>[r("编辑")]),_:2},1032,["onClick"]),e(f,{type:"danger",size:"small",onClick:m=>M(a.row.id,m)},{default:t(()=>[r("删除")]),_:2},1032,["onClick"])]),_:1})):R("",!0)]),_:1},8,["data"])]),n("div",Ue,[e(H,{background:"",layout:"prev, pager, next","page-size":l.pageSize,"onUpdate:pageSize":o[3]||(o[3]=a=>l.pageSize=a),"current-page":l.pageNum,"onUpdate:currentPage":o[4]||(o[4]=a=>l.pageNum=a),total:l.total},null,8,["page-size","current-page","total"])]),e(C,{title:l.form.id?"编辑食谱":"新增食谱",width:"50%",modelValue:l.formVisible,"onUpdate:modelValue":o[18]||(o[18]=a=>l.formVisible=a),"close-on-click-modal":!1,"destroy-on-close":""},{footer:t(()=>[n("span",De,[e(f,{onClick:o[17]||(o[17]=a=>l.formVisible=!1)},{default:t(()=>[r("取 消")]),_:1}),e(f,{type:"primary",onClick:L},{default:t(()=>[r("保 存")]),_:1})])]),default:t(()=>[e(W,{model:l.form,"label-width":"100px",style:{"padding-right":"50px"}},{default:t(()=>[e(u,{label:"食谱图片",prop:"image"},{default:t(()=>[n("div",Ie,[l.form.image?(g(),y("div",Ne,[e(N,{src:U(l.form.image),style:{width:"120px",height:"120px","border-radius":"8px",border:"1px solid #eee"},fallback:v,onError:o[5]||(o[5]=a=>I(a))},null,8,["src"]),e(f,{type:"danger",size:"small",circle:"",style:{position:"absolute",top:"-8px",right:"-8px",padding:"4px"},onClick:$},{default:t(()=>[e(K,null,{default:t(()=>[e(ie(de))]),_:1})]),_:1})])):R("",!0),n("div",Se,[e(Q,{action:T,"list-type":"picture","on-success":q,"show-file-list":!1},{default:t(()=>[e(f,{type:"primary"},{default:t(()=>[r("上传图片")]),_:1})]),_:1}),Ce])])]),_:1}),e(u,{label:"食谱名称",prop:"name"},{default:t(()=>[e(i,{modelValue:l.form.name,"onUpdate:modelValue":o[6]||(o[6]=a=>l.form.name=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(u,{label:"描述",prop:"description"},{default:t(()=>[e(i,{type:"textarea",modelValue:l.form.description,"onUpdate:modelValue":o[7]||(o[7]=a=>l.form.description=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(x,null,{default:t(()=>[e(d,{span:12},{default:t(()=>[e(u,{label:"分类",prop:"category"},{default:t(()=>[e(k,{modelValue:l.form.category,"onUpdate:modelValue":o[8]||(o[8]=a=>l.form.category=a),style:{width:"100%"}},{default:t(()=>[e(p,{label:"家常菜",value:"家常菜"}),e(p,{label:"健康餐",value:"健康餐"}),e(p,{label:"减脂餐",value:"减脂餐"}),e(p,{label:"素菜",value:"素菜"}),e(p,{label:"荤菜",value:"荤菜"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:t(()=>[e(u,{label:"难度",prop:"difficulty"},{default:t(()=>[e(k,{modelValue:l.form.difficulty,"onUpdate:modelValue":o[9]||(o[9]=a=>l.form.difficulty=a),style:{width:"100%"}},{default:t(()=>[e(p,{label:"简单",value:"简单"}),e(p,{label:"中等",value:"中等"}),e(p,{label:"困难",value:"困难"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(d,{span:12},{default:t(()=>[e(u,{label:"烹饪时间",prop:"cookingTime"},{default:t(()=>[e(i,{modelValue:l.form.cookingTime,"onUpdate:modelValue":o[10]||(o[10]=a=>l.form.cookingTime=a),type:"number"},{append:t(()=>[r("分钟")]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:t(()=>[e(u,{label:"热量",prop:"calories"},{default:t(()=>[e(i,{modelValue:l.form.calories,"onUpdate:modelValue":o[11]||(o[11]=a=>l.form.calories=a),type:"number"},{append:t(()=>[r("卡路里")]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(d,{span:8},{default:t(()=>[e(u,{label:"蛋白质",prop:"protein"},{default:t(()=>[e(i,{modelValue:l.form.protein,"onUpdate:modelValue":o[12]||(o[12]=a=>l.form.protein=a),type:"number"},{append:t(()=>[r("g")]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{span:8},{default:t(()=>[e(u,{label:"碳水化合物",prop:"carbohydrate"},{default:t(()=>[e(i,{modelValue:l.form.carbohydrate,"onUpdate:modelValue":o[13]||(o[13]=a=>l.form.carbohydrate=a),type:"number"},{append:t(()=>[r("g")]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{span:8},{default:t(()=>[e(u,{label:"脂肪",prop:"fat"},{default:t(()=>[e(i,{modelValue:l.form.fat,"onUpdate:modelValue":o[14]||(o[14]=a=>l.form.fat=a),type:"number"},{append:t(()=>[r("g")]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(u,{label:"食材清单",prop:"ingredients"},{default:t(()=>[e(i,{type:"textarea",rows:3,modelValue:l.form.ingredients,"onUpdate:modelValue":o[15]||(o[15]=a=>l.form.ingredients=a),placeholder:"每行一个食材，格式：食材名称 用量",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(u,{label:"烹饪步骤",prop:"steps"},{default:t(()=>[e(i,{type:"textarea",rows:4,modelValue:l.form.steps,"onUpdate:modelValue":o[16]||(o[16]=a=>l.form.steps=a),placeholder:"每行一个步骤",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),e(C,{title:"食谱详情",width:"60%",modelValue:l.detailVisible,"onUpdate:modelValue":o[21]||(o[21]=a=>l.detailVisible=a),"close-on-click-modal":!1},{footer:t(()=>[n("span",ol,[e(f,{onClick:o[20]||(o[20]=a=>l.detailVisible=!1)},{default:t(()=>[r("关 闭")]),_:1})])]),default:t(()=>[l.currentRecipe?(g(),y("div",ze,[e(x,{gutter:20},{default:t(()=>[e(d,{span:8},{default:t(()=>[e(N,{src:U(l.currentRecipe.image),style:{width:"100%","border-radius":"8px"},fallback:v,onError:o[19]||(o[19]=a=>I(a))},null,8,["src"])]),_:1}),e(d,{span:16},{default:t(()=>[n("h2",Te,c(l.currentRecipe.name),1),n("p",Oe,c(l.currentRecipe.description),1),e(S),e(x,{gutter:20},{default:t(()=>[e(d,{span:6},{default:t(()=>[n("div",Pe,[n("div",Je,c(l.currentRecipe.cookingTime),1),Ae])]),_:1}),e(d,{span:6},{default:t(()=>[n("div",Fe,[n("div",Be,c(l.currentRecipe.calories),1),Le])]),_:1}),e(d,{span:6},{default:t(()=>[n("div",Me,[n("div",$e,c(l.currentRecipe.protein),1),je])]),_:1}),e(d,{span:6},{default:t(()=>[n("div",qe,[n("div",Ge,c(l.currentRecipe.difficulty),1),He])]),_:1})]),_:1}),e(S),Ke,n("div",Qe,[(g(!0),y(D,null,z((l.currentRecipe.ingredients||"").split(`
`),(a,m)=>(g(),y("div",{key:m,style:{"margin-bottom":"5px"}},[e(X,{type:"success",size:"small"},{default:t(()=>[r(c(m+1),1)]),_:2},1024),n("span",We,c(a),1)]))),128))]),e(S),Xe,n("div",Ye,[(g(!0),y(D,null,z((l.currentRecipe.steps||"").split(`
`),(a,m)=>(g(),y("div",{key:m,style:{"margin-bottom":"15px"}},[n("div",Ze,[n("div",el,c(m+1),1),n("div",ll,c(a),1)])]))),128))])]),_:1})]),_:1})])):R("",!0)]),_:1},8,["modelValue"])])}}},_l=Y(tl,[["__scopeId","data-v-c20b458d"]]);export{_l as default};
