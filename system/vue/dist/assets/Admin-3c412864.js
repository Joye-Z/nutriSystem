import{r as B,o as _,c as g,d as u,e as o,w as l,x as A,z as F,C as L,D as M,F as O,q as m,i as P,G as R,E as d,H as T,I as $,v as q,y as J,n as G}from"./index-c7857d1d.js";/* empty css                   *//* empty css                    *//* empty css              *//* empty css                 *//* empty css               *//* empty css               *//* empty css                *//* empty css                     */import{r as c}from"./request-2e544c9a.js";const H={class:"card",style:{"margin-bottom":"5px"}},j={class:"card",style:{"margin-bottom":"5px"}},K={style:{"margin-bottom":"10px"}},Q={key:0},W={class:"card"},X={class:"dialog-footer"},ie={__name:"Admin",setup(Y){const b="http://:9090/files/upload",e=B({pageNum:1,pageSize:10,total:0,formVisible:!1,form:{},tableData:[],name:null}),i=()=>{c.get("/admin/selectPage",{params:{pageNum:e.pageNum,pageSize:e.pageSize,name:e.name}}).then(n=>{var t,r;e.tableData=(t=n.data)==null?void 0:t.list,e.total=(r=n.data)==null?void 0:r.total})},y=()=>{e.form={},e.formVisible=!0},V=n=>{e.form=JSON.parse(JSON.stringify(n)),e.formVisible=!0},v=()=>{c.post("/admin/add",e.form).then(n=>{n.code==="200"?(i(),d.success("操作成功"),e.formVisible=!1):d.error(n.msg)})},x=()=>{c.put("/admin/update",e.form).then(n=>{n.code==="200"?(i(),d.success("操作成功"),e.formVisible=!1):d.error(n.msg)})},h=()=>{e.form.id?x():v()},E=n=>{R.confirm("删除后数据无法恢复，您确定删除吗?","删除确认",{type:"warning"}).then(t=>{c.delete("/admin/delete/"+n).then(r=>{r.code==="200"?(i(),d.success("操作成功")):d.error(r.msg)})}).catch(t=>{})},k=()=>{e.name=null,i()},w=n=>{console.log("头像上传响应:",n),e.form.avatar=n.data,console.log("使用完整OSS URL作为头像:",e.form.avatar);const t=new Image;t.onload=()=>console.log("头像URL有效，能够正常加载"),t.onerror=()=>console.error("头像URL无效，无法加载图片"),t.src=e.form.avatar};return i(),(n,t)=>{const r=A,s=F,p=T,C=$,N=L,S=M,U=q,f=J,z=G,D=O;return _(),g("div",null,[u("div",H,[o(r,{modelValue:e.name,"onUpdate:modelValue":t[0]||(t[0]=a=>e.name=a),style:{width:"300px","margin-right":"10px"},placeholder:"请输入名称查询"},null,8,["modelValue"]),o(s,{type:"primary",onClick:i},{default:l(()=>[m("查询")]),_:1}),o(s,{type:"info",style:{margin:"0 10px"},onClick:k},{default:l(()=>[m("重置")]),_:1})]),u("div",j,[u("div",K,[o(s,{type:"primary",onClick:y},{default:l(()=>[m("新增")]),_:1})]),o(N,{data:e.tableData,stripe:""},{default:l(()=>[o(p,{label:"用户名",prop:"username"}),o(p,{label:"名称",prop:"name"}),o(p,{label:"头像"},{default:l(a=>[o(C,{src:a.row.avatar,style:{width:"40px",height:"40px","border-radius":"50%"}},null,8,["src"])]),_:1}),o(p,{label:"角色",prop:"role"},{default:l(a=>[a.row.role==="ADMIN"?(_(),g("span",Q,"管理员")):P("",!0)]),_:1}),o(p,{label:"操作",align:"center",width:"160"},{default:l(a=>[o(s,{type:"primary",onClick:I=>V(a.row)},{default:l(()=>[m("编辑")]),_:2},1032,["onClick"]),o(s,{type:"danger",onClick:I=>E(a.row.id)},{default:l(()=>[m("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),u("div",W,[o(S,{background:"",layout:"prev, pager, next","page-size":e.pageSize,"onUpdate:pageSize":t[1]||(t[1]=a=>e.pageSize=a),"current-page":e.pageNum,"onUpdate:currentPage":t[2]||(t[2]=a=>e.pageNum=a),total:e.total},null,8,["page-size","current-page","total"])]),o(D,{title:"信息",width:"40%",modelValue:e.formVisible,"onUpdate:modelValue":t[6]||(t[6]=a=>e.formVisible=a),"close-on-click-modal":!1,"destroy-on-close":""},{footer:l(()=>[u("span",X,[o(s,{onClick:t[5]||(t[5]=a=>e.formVisible=!1)},{default:l(()=>[m("取 消")]),_:1}),o(s,{type:"primary",onClick:h},{default:l(()=>[m("保 存")]),_:1})])]),default:l(()=>[o(z,{model:e.form,"label-width":"100px",style:{"padding-right":"50px"}},{default:l(()=>[o(f,{label:"头像",prop:"avatar"},{default:l(()=>[o(U,{action:b,"list-type":"picture","on-success":w},{default:l(()=>[o(s,{type:"primary"},{default:l(()=>[m("上传图片")]),_:1})]),_:1})]),_:1}),o(f,{label:"账号",prop:"username"},{default:l(()=>[o(r,{modelValue:e.form.username,"onUpdate:modelValue":t[3]||(t[3]=a=>e.form.username=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(f,{label:"名称",prop:"name"},{default:l(()=>[o(r,{modelValue:e.form.name,"onUpdate:modelValue":t[4]||(t[4]=a=>e.form.name=a),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}};export{ie as default};
